# Arquitetura TÃ©cnica e EspecificaÃ§Ãµes de ImplementaÃ§Ã£o
## Sistema de Acompanhamento de ProposiÃ§Ãµes - CNMP

**VersÃ£o:** 1.2
**Data:** 11/12/2025
**Projeto:** Sistema NAD - NÃºcleo de Acompanhamento de DecisÃµes
**OrganizaÃ§Ã£o:** Conselho Nacional do MinistÃ©rio PÃºblico (CNMP)

---

## HistÃ³rico de RevisÃµes

| VersÃ£o | Data | Autor | DescriÃ§Ã£o |
|--------|------|-------|-----------|
| 1.0 | 11/12/2025 | DocumentaÃ§Ã£o TÃ©cnica | Parte 5.1 - VisÃ£o Geral da Arquitetura e Stack TecnolÃ³gico |
| 1.1 | 11/12/2025 | DocumentaÃ§Ã£o TÃ©cnica | Parte 5.2 - Estrutura de CÃ³digo, PadrÃµes JS/CSS e GestÃ£o de Estado |
| 1.2 | 11/12/2025 | DocumentaÃ§Ã£o TÃ©cnica | Parte 5.3 - SeguranÃ§a, Performance, Compatibilidade e Deploy |

---

## SumÃ¡rio

1. [IntroduÃ§Ã£o](#1-introduÃ§Ã£o)
2. [PrincÃ­pios Arquiteturais](#2-princÃ­pios-arquiteturais)
3. [Arquitetura de Alto NÃ­vel](#3-arquitetura-de-alto-nÃ­vel)
4. [Stack TecnolÃ³gico](#4-stack-tecnolÃ³gico)
5. [Estrutura de CÃ³digo e MÃ³dulos](#5-estrutura-de-cÃ³digo-e-mÃ³dulos)
6. [PadrÃµes de CÃ³digo](#6-padrÃµes-de-cÃ³digo)
7. [GestÃ£o de Estado e PersistÃªncia](#7-gestÃ£o-de-estado-e-persistÃªncia)
8. [SeguranÃ§a](#8-seguranÃ§a)
9. [Performance](#9-performance)
10. [Compatibilidade e Deploy](#10-compatibilidade-e-deploy)

---

## 1. IntroduÃ§Ã£o

### 1.1 PropÃ³sito do Documento

Este documento descreve a arquitetura tÃ©cnica, padrÃµes de implementaÃ§Ã£o e especificaÃ§Ãµes tecnolÃ³gicas do **Sistema de Acompanhamento de ProposiÃ§Ãµes** desenvolvido para o Conselho Nacional do MinistÃ©rio PÃºblico (CNMP).

O objetivo Ã© fornecer uma visÃ£o completa da estrutura tÃ©cnica do sistema, permitindo que desenvolvedores:
- Compreendam as decisÃµes arquiteturais e suas justificativas
- Implementem novas funcionalidades seguindo os padrÃµes estabelecidos
- Mantenham e evoluam o cÃ³digo de forma consistente
- Identifiquem pontos de extensÃ£o e customizaÃ§Ã£o

### 1.2 Escopo

Este documento cobre:
- âœ… Arquitetura de software e padrÃµes de design
- âœ… Stack tecnolÃ³gico e dependÃªncias
- âœ… Estrutura de cÃ³digo e organizaÃ§Ã£o de arquivos
- âœ… PadrÃµes de desenvolvimento (JavaScript, CSS, HTML)
- âœ… GestÃ£o de estado e persistÃªncia de dados
- âœ… SeguranÃ§a e validaÃ§Ãµes
- âœ… Performance e otimizaÃ§Ãµes
- âœ… Compatibilidade de navegadores
- âœ… Processo de deploy e distribuiÃ§Ã£o

Este documento **nÃ£o** cobre:
- âŒ Requisitos funcionais (ver `requisitos_funcionais.md`)
- âŒ EspecificaÃ§Ãµes de interface (ver `especificacoes_de_interface.md`)
- âŒ Modelo de dados detalhado (ver `modelo_de_dados.md`)
- âŒ Manuais de usuÃ¡rio final
- âŒ Infraestrutura de servidor (o sistema Ã© client-side only)

### 1.3 PÃºblico-Alvo

- **Desenvolvedores:** ImplementaÃ§Ã£o de novas features e manutenÃ§Ã£o
- **Arquitetos de Software:** AvaliaÃ§Ã£o e evoluÃ§Ã£o da arquitetura
- **Tech Leads:** RevisÃ£o de cÃ³digo e padrÃµes
- **DevOps:** Deploy e configuraÃ§Ã£o de ambientes
- **QA Engineers:** Testes e validaÃ§Ãµes tÃ©cnicas

### 1.4 Contexto do Sistema

O Sistema de Acompanhamento de ProposiÃ§Ãµes Ã© uma **aplicaÃ§Ã£o web client-side** que gerencia o ciclo de vida de proposiÃ§Ãµes oriundas de correiÃ§Ãµes realizadas pela Corregedoria Nacional do CNMP.

**CaracterÃ­sticas principais:**
- **ProtÃ³tipo funcional:** Desenvolvido para validaÃ§Ã£o de conceito
- **Zero dependencies:** Sem frameworks, bibliotecas externas ou build tools
- **Client-side only:** Toda lÃ³gica executada no navegador
- **PersistÃªncia local:** Dados armazenados em `localStorage`
- **Dois perfis:** Admin (Corregedoria Nacional) e User (MP Correicionado)

**LimitaÃ§Ãµes conhecidas (ambiente de protÃ³tipo):**
- Sem autenticaÃ§Ã£o real (aceita qualquer credencial)
- Sem backend (nÃ£o hÃ¡ servidor de aplicaÃ§Ã£o)
- Sem banco de dados (dados em memÃ³ria/localStorage)
- Sem upload real de arquivos (simulado)
- Sem envio de emails (simulado)
- Sem controle de concorrÃªncia

---

## 2. PrincÃ­pios Arquiteturais

Esta seÃ§Ã£o descreve os princÃ­pios fundamentais que guiaram as decisÃµes arquiteturais do sistema.

---

### 2.1 Zero Dependencies

**DescriÃ§Ã£o:**
O sistema foi desenvolvido **sem nenhuma dependÃªncia externa** - sem frameworks JavaScript, bibliotecas CSS, bundlers ou gerenciadores de pacotes.

**Justificativa:**
- **Simplicidade:** Reduz complexidade de setup, build e deploy
- **Performance:** Elimina overhead de frameworks (parsing, reconciliation, virtual DOM)
- **Manutenibilidade:** CÃ³digo mais previsÃ­vel e debugÃ¡vel
- **Portabilidade:** Funciona em qualquer servidor web estÃ¡tico
- **Aprendizado:** Facilita compreensÃ£o de fundamentos web

**ImplementaÃ§Ã£o:**
```
âœ… SIM: HTML5, CSS3, JavaScript ES6+ nativos
âœ… SIM: APIs nativas do navegador (localStorage, Canvas, Drag & Drop)
âœ… SIM: Web Standards (Fetch API, Promise, async/await)

âŒ NÃƒO: React, Vue, Angular, Svelte
âŒ NÃƒO: Bootstrap, Tailwind, Material-UI
âŒ NÃƒO: jQuery, Lodash, Moment.js
âŒ NÃƒO: Webpack, Vite, Rollup, Parcel
âŒ NÃƒO: npm, yarn, pnpm
```

**BenefÃ­cios observados:**
- **Startup instantÃ¢neo:** Sem download/parsing de megabytes de cÃ³digo
- **Bundle size:** ~10KB total (minificado e gzipped)
- **Debugging direto:** Chrome DevTools sem source maps
- **Deploy trivial:** Copiar arquivos para servidor HTTP

**Trade-offs:**
- **Mais cÃ³digo boilerplate:** ImplementaÃ§Ã£o manual de padrÃµes comuns
- **Sem ecossistema:** Bibliotecas de terceiros nÃ£o disponÃ­veis
- **Compatibilidade manual:** Sem transpilaÃ§Ã£o automÃ¡tica (Babel)
- **DX limitado:** Sem hot reload, TypeScript, linters integrados

---

### 2.2 Progressive Enhancement

**DescriÃ§Ã£o:**
O sistema Ã© construÃ­do em camadas, garantindo funcionalidade bÃ¡sica mesmo em ambientes com recursos limitados, e melhorando a experiÃªncia quando recursos avanÃ§ados estÃ£o disponÃ­veis.

**Camadas de Enhancement:**

**1. Camada Base (HTML SemÃ¢ntico):**
```html
<!-- Funcional mesmo sem CSS ou JavaScript -->
<form action="#" method="post">
    <label for="numero">NÃºmero da ProposiÃ§Ã£o:</label>
    <input type="text" id="numero" name="numero" required>

    <button type="submit">Cadastrar</button>
</form>
```

**2. Camada de ApresentaÃ§Ã£o (CSS):**
```css
/* Melhora visual sem quebrar funcionalidade */
.form-control {
    padding: 0.75rem;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
}
```

**3. Camada de Comportamento (JavaScript):**
```javascript
// Adiciona validaÃ§Ã£o e feedback em tempo real
document.getElementById('numero').addEventListener('input', (e) => {
    validateNumero(e.target.value);
});
```

**4. Camada de OtimizaÃ§Ã£o (APIs AvanÃ§adas):**
```javascript
// Usa recursos modernos quando disponÃ­veis
if ('IntersectionObserver' in window) {
    // Lazy loading de imagens
    lazyLoadImages();
} else {
    // Fallback: carrega todas as imagens
    loadAllImages();
}
```

**EstratÃ©gias de Enhancement:**

**CSS:**
- Usa `@supports` para features modernas:
```css
@supports (display: grid) {
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
    }
}

@supports not (display: grid) {
    .stats-grid {
        display: flex;
        flex-wrap: wrap;
    }
}
```

**JavaScript:**
- Feature detection antes de uso:
```javascript
// Drag & Drop file upload
if ('draggable' in document.createElement('div')) {
    setupDragAndDrop();
} else {
    // Fallback: apenas click to select
    setupClickToSelect();
}
```

**localStorage:**
- Graceful degradation se nÃ£o disponÃ­vel:
```javascript
function saveToStorage(key, data) {
    try {
        localStorage.setItem(key, JSON.stringify(data));
        return true;
    } catch (e) {
        console.warn('localStorage nÃ£o disponÃ­vel:', e);
        // Fallback: manter apenas em memÃ³ria
        return false;
    }
}
```

---

### 2.3 Mobile First

**DescriÃ§Ã£o:**
O design e desenvolvimento comeÃ§am pela experiÃªncia mobile, expandindo progressivamente para telas maiores.

**ImplementaÃ§Ã£o:**

**CSS Base (Mobile):**
```css
/* Estilos padrÃ£o para mobile (< 768px) */
.sidebar {
    position: fixed;
    left: -100%;
    width: 80%;
    transition: left 0.3s;
}

.main-content {
    margin-left: 0;
    padding: 1rem;
}
```

**Media Queries Incrementais:**
```css
/* Tablet (â‰¥ 768px) */
@media (min-width: 768px) {
    .sidebar {
        left: 0;
        width: 250px;
        position: static;
    }

    .main-content {
        margin-left: 250px;
        padding: 2rem;
    }
}

/* Desktop (â‰¥ 1200px) */
@media (min-width: 1200px) {
    .main-content {
        max-width: 1140px;
        margin: 0 auto;
    }
}
```

**Touch-First Interactions:**
```css
/* Touch targets mÃ­nimos: 44x44px */
.btn {
    min-height: 44px;
    min-width: 44px;
    padding: 0.75rem 1.5rem;
}

/* Hover apenas em dispositivos que suportam */
@media (hover: hover) {
    .btn:hover {
        background: var(--primary-dark);
    }
}
```

**BenefÃ­cios:**
- Melhor performance em dispositivos mÃ³veis
- ExperiÃªncia consistente em todos os tamanhos de tela
- Foco em conteÃºdo essencial
- ReduÃ§Ã£o de complexidade no CSS

---

### 2.4 Separation of Concerns

**DescriÃ§Ã£o:**
O sistema separa claramente responsabilidades entre estrutura (HTML), apresentaÃ§Ã£o (CSS) e comportamento (JavaScript).

**Estrutura de SeparaÃ§Ã£o:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HTML (Estrutura e ConteÃºdo)             â”‚
â”‚ - MarcaÃ§Ã£o semÃ¢ntica                    â”‚
â”‚ - Hierarquia de informaÃ§Ã£o              â”‚
â”‚ - FormulÃ¡rios e validaÃ§Ã£o base          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CSS (ApresentaÃ§Ã£o e Layout)             â”‚
â”‚ - Estilos visuais                       â”‚
â”‚ - Layout responsivo                     â”‚
â”‚ - AnimaÃ§Ãµes e transiÃ§Ãµes                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ JavaScript (Comportamento e LÃ³gica)     â”‚
â”‚ - InteraÃ§Ãµes do usuÃ¡rio                 â”‚
â”‚ - ManipulaÃ§Ã£o de dados                  â”‚
â”‚ - RenderizaÃ§Ã£o dinÃ¢mica                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Exemplo PrÃ¡tico:**

**HTML - Estrutura:**
```html
<div class="stat-card" data-metric="total-proposicoes">
    <div class="stat-icon">ğŸ“„</div>
    <div class="stat-content">
        <span class="stat-value">0</span>
        <span class="stat-label">Total de ProposiÃ§Ãµes</span>
    </div>
</div>
```

**CSS - ApresentaÃ§Ã£o:**
```css
.stat-card {
    background: white;
    border-radius: var(--radius-md);
    padding: 1.5rem;
    box-shadow: var(--shadow-sm);
    display: flex;
    align-items: center;
    gap: 1rem;
}

.stat-value {
    font-size: 2rem;
    font-weight: 700;
    color: var(--primary-color);
}
```

**JavaScript - Comportamento:**
```javascript
function updateStatCard(metric, value) {
    const card = document.querySelector(`[data-metric="${metric}"]`);
    const valueEl = card.querySelector('.stat-value');
    valueEl.textContent = value;

    // AnimaÃ§Ã£o de contagem
    animateNumber(valueEl, 0, value, 500);
}
```

**BenefÃ­cios:**
- **Manutenibilidade:** MudanÃ§as em uma camada nÃ£o afetam outras
- **Testabilidade:** LÃ³gica JavaScript testÃ¡vel independentemente
- **ReutilizaÃ§Ã£o:** CSS e componentes HTML reutilizÃ¡veis
- **Performance:** CSS e JS podem ser cacheados separadamente

---

### 2.5 Single Responsibility Principle (SRP)

**DescriÃ§Ã£o:**
Cada funÃ§Ã£o, mÃ³dulo ou componente tem uma Ãºnica responsabilidade bem definida.

**AplicaÃ§Ã£o no Sistema:**

**FunÃ§Ãµes com Responsabilidade Ãšnica:**

```javascript
// âŒ MAU: FunÃ§Ã£o faz muitas coisas
function handleProposicaoSubmit(event) {
    event.preventDefault();
    const data = getFormData();
    if (!validateData(data)) return;
    const id = generateId();
    proposicoes.push({ id, ...data });
    saveToLocalStorage();
    renderTable();
    showSuccessMessage();
    clearForm();
}

// âœ… BOM: Cada funÃ§Ã£o tem uma responsabilidade
function handleProposicaoSubmit(event) {
    event.preventDefault();

    const data = extractFormData(event.target);
    if (!isValidProposicao(data)) return;

    const proposicao = createProposicao(data);
    addProposicao(proposicao);

    persistData();
    refreshUI();
}

function extractFormData(form) {
    // Responsabilidade: extrair dados do formulÃ¡rio
    return {
        numero: form.numero.value,
        descricao: form.descricao.value,
        // ...
    };
}

function isValidProposicao(data) {
    // Responsabilidade: validar dados
    if (!data.numero) return false;
    if (data.descricao.length > 5000) return false;
    return true;
}

function createProposicao(data) {
    // Responsabilidade: criar objeto proposiÃ§Ã£o
    return {
        id: generateUniqueId(),
        status: ['pendente', 'nova'],
        historico: [],
        ...data
    };
}

function addProposicao(proposicao) {
    // Responsabilidade: adicionar ao array global
    proposicoes.push(proposicao);
}

function persistData() {
    // Responsabilidade: salvar em localStorage
    localStorage.setItem('proposicoes', JSON.stringify(proposicoes));
}

function refreshUI() {
    // Responsabilidade: atualizar interface
    renderProposicoesTable();
    updateDashboard();
}
```

**BenefÃ­cios:**
- FunÃ§Ãµes menores e mais fÃ¡ceis de entender
- Testes unitÃ¡rios mais simples
- ReutilizaÃ§Ã£o de cÃ³digo
- Facilita refatoraÃ§Ã£o

---

### 2.6 Convention Over Configuration

**DescriÃ§Ã£o:**
O sistema adota convenÃ§Ãµes bem definidas para reduzir decisÃµes de configuraÃ§Ã£o e aumentar a consistÃªncia.

**ConvenÃ§Ãµes Adotadas:**

**Nomenclatura de Arquivos:**
```
index.html          â†’ PÃ¡gina SPA principal
proposicoes.html    â†’ PÃ¡gina standalone (plural do domÃ­nio)
avaliacao.html      â†’ PÃ¡gina standalone (singular da aÃ§Ã£o)
styles.css          â†’ Estilos globais Ãºnicos
app.js              â†’ LÃ³gica da aplicaÃ§Ã£o Ãºnica
```

**Nomenclatura de IDs e Classes:**
```html
<!-- IDs: camelCase para JavaScript -->
<div id="dashboardPage"></div>
<button id="submitButton"></button>

<!-- Classes: kebab-case para CSS -->
<div class="stat-card"></div>
<button class="btn btn-primary"></button>
```

**Estrutura de Dados:**
```javascript
// Sempre usar arrays plurais no escopo global
let correicoes = [];
let proposicoes = [];

// IDs sempre numÃ©ricos incrementais
{ id: 1, numero: 'COR-2024-01', ... }

// Datas sempre ISO string
{ dataInicio: '2024-01-15', dataPublicacao: '2024-11-01' }

// Status bidimensional sempre array de 2 elementos
{ status: ['pendente', 'nova'] }
```

**FunÃ§Ãµes UtilitÃ¡rias:**
```javascript
// Prefixo indicando tipo de retorno
function getProposicaoById(id)      // retorna objeto ou null
function findProposicoes(filter)    // retorna array
function isProposicaoPendente(id)   // retorna boolean
function formatDate(dateString)     // retorna string formatada
function renderTable()              // void, atualiza DOM
function saveToLocalStorage()       // void, persiste dados
```

**Eventos e Handlers:**
```html
<!-- ConvenÃ§Ã£o: onclick inline para navegaÃ§Ã£o simples -->
<button onclick="showPage('dashboard')">Dashboard</button>

<!-- addEventListener para lÃ³gica complexa -->
<script>
document.getElementById('form').addEventListener('submit', handleSubmit);
</script>
```

---

## 3. Arquitetura de Alto NÃ­vel

### 3.1 VisÃ£o Geral

O sistema segue uma arquitetura **client-side SPA hÃ­brida**, combinando:
- **Single Page Application (SPA)** - index.html com navegaÃ§Ã£o interna via hash
- **PÃ¡ginas Standalone** - 4 pÃ¡ginas HTML independentes para workflows especÃ­ficos

**Diagrama Conceitual:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        NAVEGADOR                             â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              SINGLE PAGE APP (index.html)              â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚  â”‚  â”‚Dashboard â”‚  â”‚CorreiÃ§Ãµesâ”‚  â”‚  Enviar  â”‚  â”‚Avaliar â”‚â”‚ â”‚
â”‚  â”‚  â”‚  #dash   â”‚  â”‚  #corr   â”‚  â”‚  #enviar â”‚  â”‚ #aval  â”‚â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚ â”‚
â”‚  â”‚  â”‚  Cadastro  â”‚  â”‚  Cadastro  â”‚                       â”‚ â”‚
â”‚  â”‚  â”‚ CorreiÃ§Ã£o  â”‚  â”‚ ProposiÃ§Ã£o â”‚                       â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚           PÃGINAS STANDALONE (workflows)               â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  proposicoes.html    publicacao.html                   â”‚ â”‚
â”‚  â”‚  avaliacao.html      comprovacao.html                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              CAMADA DE DADOS (app.js)                  â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  let correicoes = [];                                  â”‚ â”‚
â”‚  â”‚  let proposicoes = [];                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â†•                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚         PERSISTÃŠNCIA (localStorage)                    â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  'correicoes'      'proposicoes'                       â”‚ â”‚
â”‚  â”‚  'currentUser'     'sessionData'                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3.2 Componentes Principais

#### 3.2.1 Index.html (SPA Core)

**Responsabilidades:**
- Ponto de entrada da aplicaÃ§Ã£o
- Gerenciamento de autenticaÃ§Ã£o/sessÃ£o
- NavegaÃ§Ã£o entre pÃ¡ginas internas (#hash)
- Dashboard e visualizaÃ§Ãµes agregadas
- Cadastros (admin only)
- Envio de comprovaÃ§Ãµes (user)
- AvaliaÃ§Ãµes (admin)

**Estrutura Interna:**
```html
<body>
    <!-- Layout Fixo -->
    <header class="header">...</header>
    <nav class="sidebar">...</nav>

    <!-- PÃ¡ginas Internas (uma visÃ­vel por vez) -->
    <main class="main-content">
        <div id="dashboardPage" class="page">...</div>
        <div id="correicoesPage" class="page hidden">...</div>
        <div id="enviarPage" class="page hidden">...</div>
        <div id="avaliarPage" class="page hidden">...</div>
        <div id="cadastroCorreicaoPage" class="page hidden">...</div>
        <div id="cadastroPage" class="page hidden">...</div>
    </main>

    <!-- Modais Globais -->
    <div id="detailModal" class="modal hidden">...</div>
    <div id="correicaoModal" class="modal hidden">...</div>
</body>
```

**NavegaÃ§Ã£o:**
```javascript
function showPage(pageId) {
    // Esconde todas as pÃ¡ginas
    document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));

    // Mostra pÃ¡gina alvo
    document.getElementById(pageId + 'Page').classList.remove('hidden');

    // Atualiza URL hash
    window.location.hash = pageId;

    // LÃ³gica especÃ­fica por pÃ¡gina
    if (pageId === 'dashboard') updateDashboard();
    if (pageId === 'correicoes') renderCorreicoesTable();
}
```

---

#### 3.2.2 PÃ¡ginas Standalone

**1. proposicoes.html**
- **PropÃ³sito:** Listagem e gestÃ£o de proposiÃ§Ãµes
- **Acesso:** Todos os usuÃ¡rios via sidebar
- **Features:** Progressive disclosure (seleÃ§Ã£o de correiÃ§Ã£o obrigatÃ³ria), filtros avanÃ§ados, ediÃ§Ã£o inline, redirecionamento para avaliaÃ§Ã£o
- **SessÃ£o:** Independente, carrega de localStorage

**2. publicacao.html**
- **PropÃ³sito:** PublicaÃ§Ã£o em lote de proposiÃ§Ãµes
- **Acesso:** Admin only (validaÃ§Ã£o na init)
- **Features:** SeleÃ§Ã£o batch com checkboxes, prazo Ãºnico para todas, historico de publicaÃ§Ã£o
- **SessÃ£o:** Independente, validaÃ§Ã£o de admin

**3. avaliacao.html**
- **PropÃ³sito:** Avaliar comprovaÃ§Ãµes individuais
- **Acesso:** Admin via query string `?id=X`
- **Features:** Timeline completa, 4 cards de decisÃ£o, parecer obrigatÃ³rio
- **SessÃ£o:** Independente, recebe ID via URL

**4. comprovacao.html**
- **PropÃ³sito:** Envio/ediÃ§Ã£o de comprovaÃ§Ãµes
- **Acesso:** User via query string `?id=X`
- **Features:** Drag & drop upload, rascunho automÃ¡tico, prazo alert
- **SessÃ£o:** Independente, auto-load de rascunho

**PadrÃ£o de ComunicaÃ§Ã£o:**
```
index.html â†’ proposicoes.html (sidebar click)
           â†’ publicacao.html (sidebar click, admin)
           â†’ avaliacao.html?id=X (botÃ£o avaliar)
           â†’ comprovacao.html?id=X (botÃ£o adicionar/editar)

Retorno: Breadcrumb â†’ index.html (ou index.html#enviar)
```

---

#### 3.2.3 Camada de Dados (app.js)

**Estado Global:**
```javascript
// Arrays de dados (fonte Ãºnica de verdade)
let correicoes = [];
let proposicoes = [];

// SessÃ£o do usuÃ¡rio
let currentUser = null;

// Estado da UI
let dashboardCorreicaoFilter = null;
let correicoesSortColumn = null;
let correicoesSortDirection = 'asc';
```

**OperaÃ§Ãµes CRUD:**
```javascript
// Create
function createCorreicao(data) {
    const id = getNextId(correicoes);
    const correicao = { id, ...data };
    correicoes.push(correicao);
    saveToLocalStorage();
    return correicao;
}

// Read
function getCorreicaoById(id) {
    return correicoes.find(c => c.id === id);
}

function getProposicoesByCorreicao(correicaoId) {
    return proposicoes.filter(p => p.correicaoId === correicaoId);
}

// Update
function updateProposicaoStatus(id, newStatus) {
    const prop = proposicoes.find(p => p.id === id);
    if (prop) {
        prop.status = newStatus;
        saveToLocalStorage();
    }
}

// Delete (nÃ£o implementado - sistema apenas adiciona/atualiza)
```

**PersistÃªncia:**
```javascript
function saveToLocalStorage() {
    localStorage.setItem('correicoes', JSON.stringify(correicoes));
    localStorage.setItem('proposicoes', JSON.stringify(proposicoes));
}

function loadFromLocalStorage() {
    const correicoesData = localStorage.getItem('correicoes');
    const proposicoesData = localStorage.getItem('proposicoes');

    correicoes = correicoesData ? JSON.parse(correicoesData) : [];
    proposicoes = proposicoesData ? JSON.parse(proposicoesData) : [];
}
```

---

#### 3.2.4 Camada de ApresentaÃ§Ã£o (styles.css)

**OrganizaÃ§Ã£o:**
```css
/* 1. Custom Properties (Tema) */
:root {
    --primary-color: #003366;
    --secondary-color: #0066cc;
    /* ... */
}

/* 2. Reset e Base Styles */
* { box-sizing: border-box; }
body { margin: 0; font-family: 'Segoe UI', sans-serif; }

/* 3. Layout Estrutural */
.header { height: 60px; }
.sidebar { width: 250px; }
.main-content { margin-left: 250px; }

/* 4. Componentes ReutilizÃ¡veis */
.btn { padding: 0.75rem 1.5rem; }
.badge { padding: 0.25rem 0.75rem; }
.stat-card { background: white; }

/* 5. PÃ¡ginas EspecÃ­ficas */
.dashboard { ... }
.correicoes-page { ... }

/* 6. Responsividade */
@media (max-width: 768px) { ... }
```

---

### 3.3 Fluxo de Dados

**PadrÃ£o Unidirecional:**

```
USER ACTION
    â†“
EVENT HANDLER (JavaScript)
    â†“
DATA MUTATION (Arrays Globais)
    â†“
PERSISTENCE (localStorage)
    â†“
UI UPDATE (Render Functions)
    â†“
DOM MANIPULATION
    â†“
VISUAL FEEDBACK (CSS)
```

**Exemplo Completo:**

```javascript
// 1. USER ACTION: Click no botÃ£o "Cadastrar ProposiÃ§Ã£o"
document.getElementById('cadastroForm').addEventListener('submit', (e) => {
    e.preventDefault();

    // 2. EVENT HANDLER: Extrair dados do formulÃ¡rio
    const formData = {
        numero: document.getElementById('numero').value,
        descricao: document.getElementById('descricao').value,
        correicaoId: parseInt(document.getElementById('correicaoId').value),
        status: ['pendente', 'nova'],
        historico: []
    };

    // 3. DATA MUTATION: Adicionar ao array global
    const id = proposicoes.length > 0
        ? Math.max(...proposicoes.map(p => p.id)) + 1
        : 1;
    proposicoes.push({ id, ...formData });

    // 4. PERSISTENCE: Salvar em localStorage
    localStorage.setItem('proposicoes', JSON.stringify(proposicoes));

    // 5. UI UPDATE: Re-renderizar componentes afetados
    renderProposicoesTable();
    updateDashboard();

    // 6. VISUAL FEEDBACK: Mensagem de sucesso
    alert('âœ… ProposiÃ§Ã£o cadastrada com sucesso!');
    e.target.reset();
});
```

---

### 3.4 Ciclo de Vida da AplicaÃ§Ã£o

**1. InicializaÃ§Ã£o (Page Load):**
```javascript
window.addEventListener('DOMContentLoaded', () => {
    // 1. Carregar dados do localStorage
    loadFromLocalStorage();

    // 2. Se nÃ£o hÃ¡ dados, inicializar com amostra
    if (correicoes.length === 0) {
        initializeSampleData();
    }

    // 3. Verificar sessÃ£o
    const session = localStorage.getItem('currentUser');
    if (session) {
        currentUser = JSON.parse(session);
        showMainApp();
    } else {
        showLoginPage();
    }

    // 4. Setup de event listeners globais
    setupGlobalEventListeners();
});
```

**2. AutenticaÃ§Ã£o:**
```javascript
function handleLogin(username, password, type, ramoMP) {
    // ProtÃ³tipo: aceita qualquer credencial
    currentUser = {
        username,
        type, // 'admin' ou 'user'
        ramoMP: type === 'user' ? ramoMP : null,
        ramoMPNome: type === 'user' ? getRamoMPNome(ramoMP) : null
    };

    // Salvar sessÃ£o
    localStorage.setItem('currentUser', JSON.stringify(currentUser));

    // Mostrar app
    showMainApp();
}
```

**3. NavegaÃ§Ã£o:**
```javascript
// Hash-based routing
window.addEventListener('hashchange', () => {
    const hash = window.location.hash.substring(1) || 'dashboard';
    showPage(hash);
});
```

**4. OperaÃ§Ãµes de Dados:**
```javascript
// Sempre seguir o padrÃ£o:
// 1. MutaÃ§Ã£o do array global
// 2. PersistÃªncia em localStorage
// 3. Re-renderizaÃ§Ã£o da UI

function addProposicao(data) {
    proposicoes.push(data);
    saveToLocalStorage();
    renderProposicoesTable();
    updateDashboard();
}
```

**5. Logout:**
```javascript
function logout() {
    // Limpar sessÃ£o (dados permanecem)
    localStorage.removeItem('currentUser');
    currentUser = null;

    // Voltar para login
    showLoginPage();
}
```

---

## 4. Stack TecnolÃ³gico

### 4.1 Frontend Stack

#### 4.1.1 HTML5

**VersÃ£o:** HTML5 (2014+)

**Features Utilizadas:**
- **Elementos SemÃ¢nticos:**
  - `<header>`, `<nav>`, `<main>`, `<section>`, `<article>`, `<footer>`
  - Melhora acessibilidade e SEO

- **FormulÃ¡rios AvanÃ§ados:**
  - `<input type="date">` para seleÃ§Ã£o de datas
  - `<input type="number">` para valores numÃ©ricos
  - Atributos de validaÃ§Ã£o: `required`, `maxlength`, `pattern`

- **APIs de InteraÃ§Ã£o:**
  - Drag and Drop API (upload de arquivos)
  - File API (leitura de arquivos locais)

**Exemplo:**
```html
<form id="cadastroForm" novalidate>
    <input type="text"
           id="numero"
           name="numero"
           required
           pattern="PROP-\d{4}-\d{4}"
           maxlength="20"
           aria-required="true">

    <input type="date"
           id="dataInicio"
           name="dataInicio"
           min="2024-01-01"
           max="2025-12-31">
</form>
```

---

#### 4.1.2 CSS3

**VersÃ£o:** CSS3 (com prefixos vendor quando necessÃ¡rio)

**Features Utilizadas:**

**1. Custom Properties (CSS Variables):**
```css
:root {
    --primary-color: #003366;
    --secondary-color: #0066cc;
    --border-radius: 8px;
    --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
}

.btn-primary {
    background: var(--primary-color);
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-sm);
}
```

**2. Flexbox e Grid:**
```css
/* Flexbox para componentes lineares */
.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

/* Grid para layouts complexos */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 1.5rem;
}
```

**3. AnimaÃ§Ãµes e TransiÃ§Ãµes:**
```css
.modal {
    transition: opacity 0.3s ease-out;
    animation: slideUp 0.3s ease-out;
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(50px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
```

**4. Media Queries:**
```css
@media (max-width: 768px) {
    .sidebar { width: 80%; left: -100%; }
}

@media (hover: hover) {
    .btn:hover { background: var(--primary-dark); }
}

@media print {
    .no-print { display: none; }
}
```

**5. Feature Queries:**
```css
@supports (display: grid) {
    .grid-container { display: grid; }
}

@supports not (display: grid) {
    .grid-container { display: flex; flex-wrap: wrap; }
}
```

---

#### 4.1.3 JavaScript (ES6+)

**VersÃ£o:** ECMAScript 2015+ (ES6, ES7, ES8, ES9)

**Features Utilizadas:**

**1. let/const (ES6):**
```javascript
let correicoes = [];
const MAX_FILE_SIZE = 10 * 1024 * 1024;
```

**2. Arrow Functions (ES6):**
```javascript
proposicoes.filter(p => p.status[0] === 'pendente')
           .map(p => renderProposicaoCard(p))
           .forEach(card => container.appendChild(card));
```

**3. Template Literals (ES6):**
```javascript
const html = `
    <div class="stat-card">
        <span class="value">${count}</span>
        <span class="label">${label}</span>
    </div>
`;
```

**4. Destructuring (ES6):**
```javascript
const { id, numero, descricao } = proposicao;
const [statusProcessual, valoracao] = proposicao.status;
```

**5. Spread Operator (ES6):**
```javascript
const newProposicao = {
    id: generateId(),
    ...formData,
    status: ['pendente', 'nova'],
    historico: []
};
```

**6. Default Parameters (ES6):**
```javascript
function formatDate(dateString, format = 'DD/MM/YYYY') {
    // ...
}
```

**7. Array Methods (ES5/ES6):**
```javascript
// find, filter, map, reduce, some, every
const prop = proposicoes.find(p => p.id === id);
const pendentes = proposicoes.filter(p => p.status[0] === 'pendente');
const total = proposicoes.reduce((acc, p) => acc + 1, 0);
```

**8. Promise e async/await (ES6/ES7):**
```javascript
async function loadExternalData() {
    try {
        const response = await fetch('/api/data');
        const data = await response.json();
        return data;
    } catch (error) {
        console.error('Erro ao carregar dados:', error);
    }
}
```

**9. Object.entries/Object.keys (ES7/ES8):**
```javascript
Object.entries(statusCounts).forEach(([status, count]) => {
    console.log(`${status}: ${count}`);
});
```

**10. Nullish Coalescing (??) (ES11):**
```javascript
const prazo = proposicao.prazoComprovacao ?? 'NÃ£o definido';
```

**11. Optional Chaining (?.) (ES11):**
```javascript
const ramoMP = currentUser?.ramoMP ?? 'NÃ£o disponÃ­vel';
```

**Compatibilidade:**
- Target: Navegadores modernos (Chrome 90+, Firefox 88+, Safari 14+, Edge 90+)
- Sem transpilaÃ§Ã£o (Babel) por escolha de design
- Feature detection para funcionalidades crÃ­ticas

---

### 4.2 APIs Nativas do Navegador

#### 4.2.1 localStorage API

**PropÃ³sito:** PersistÃªncia de dados no navegador

**Uso:**
```javascript
// Salvar
localStorage.setItem('correicoes', JSON.stringify(correicoes));

// Ler
const data = localStorage.getItem('correicoes');
const correicoes = data ? JSON.parse(data) : [];

// Remover
localStorage.removeItem('currentUser');

// Limpar tudo
localStorage.clear();
```

**Capacidade:** ~5-10MB por domÃ­nio (varia por navegador)

**LimitaÃ§Ãµes:**
- SÃ­ncrono (pode bloquear UI em datasets grandes)
- Apenas strings (requer JSON.stringify/parse)
- Sem expiraÃ§Ã£o automÃ¡tica
- VulnerÃ¡vel a XSS

**Alternativas Consideradas:**
- IndexedDB: Mais complexo, desnecessÃ¡rio para protÃ³tipo
- SessionStorage: Perderia dados ao fechar aba
- Cookies: Limitado a 4KB, enviado em requests

---

#### 4.2.2 Canvas API

**PropÃ³sito:** RenderizaÃ§Ã£o de grÃ¡ficos (charts)

**Uso:**
```javascript
const canvas = document.getElementById('chartCanvas');
const ctx = canvas.getContext('2d');

// Desenhar barra
ctx.fillStyle = '#0066cc';
ctx.fillRect(x, y, width, height);

// Texto
ctx.font = '14px Segoe UI';
ctx.fillStyle = '#333';
ctx.fillText(label, x, y);
```

**Vantagens:**
- Performance superior a SVG para muitos elementos
- Controle pixel-level
- Sem dependÃªncias de bibliotecas de charts

**Desvantagens:**
- NÃ£o responsivo nativamente (requer resize handling)
- Sem acessibilidade built-in (precisa de aria-label)

---

#### 4.2.3 Drag and Drop API

**PropÃ³sito:** Upload de arquivos por arrastar e soltar

**Uso:**
```javascript
const uploadArea = document.getElementById('uploadArea');

uploadArea.addEventListener('dragover', (e) => {
    e.preventDefault();
    uploadArea.classList.add('drag-over');
});

uploadArea.addEventListener('drop', (e) => {
    e.preventDefault();
    const files = e.dataTransfer.files;
    handleFiles(files);
});
```

---

#### 4.2.4 History API

**PropÃ³sito:** Gerenciamento de navegaÃ§Ã£o (hash-based routing)

**Uso:**
```javascript
// Alterar hash sem reload
window.location.hash = 'dashboard';

// Detectar mudanÃ§as
window.addEventListener('hashchange', () => {
    const page = window.location.hash.substring(1);
    showPage(page);
});
```

---

### 4.3 Ferramentas de Desenvolvimento

**Nenhuma ferramenta externa Ã© necessÃ¡ria para desenvolvimento ou build:**

```bash
# Desenvolvimento
open index.html  # Ou abrir no navegador

# Testing local
python3 -m http.server 8000
# acessar http://localhost:8000

# Deploy
cp -r * /var/www/html/  # Copiar arquivos para servidor
```

**RecomendaÃ§Ãµes Opcionais:**
- **Editor:** VS Code com extensÃµes HTML/CSS/JS Intellisense
- **ValidaÃ§Ã£o:** W3C Validator, JSHint, CSS Validator
- **Debugging:** Chrome DevTools, Firefox Developer Tools
- **Performance:** Lighthouse, WebPageTest
- **Acessibilidade:** axe DevTools, WAVE

---

**Fim da Parte 5.1**

---

## 5. Estrutura de CÃ³digo e MÃ³dulos

### 5.1 OrganizaÃ§Ã£o de Arquivos

O projeto segue uma estrutura plana e simples, sem diretÃ³rios aninhados ou sistemas de build complexos.

**Estrutura Completa:**

```
sistema_do_nad/
â”‚
â”œâ”€â”€ index.html              # SPA principal (6 pÃ¡ginas internas)
â”‚   â””â”€â”€ 2.700+ linhas       # Dashboard, CorreiÃ§Ãµes, Enviar, Avaliar, Cadastros
â”‚
â”œâ”€â”€ proposicoes.html        # PÃ¡gina standalone - GestÃ£o de proposiÃ§Ãµes
â”‚   â””â”€â”€ 840 linhas          # SeleÃ§Ã£o de correiÃ§Ã£o + filtros + ediÃ§Ã£o
â”‚
â”œâ”€â”€ publicacao.html         # PÃ¡gina standalone - PublicaÃ§Ã£o em lote (admin)
â”‚   â””â”€â”€ 1.100 linhas        # Batch selection + formulÃ¡rio de publicaÃ§Ã£o
â”‚
â”œâ”€â”€ avaliacao.html          # PÃ¡gina standalone - AvaliaÃ§Ã£o individual (admin)
â”‚   â””â”€â”€ 913 linhas          # 4 decision cards + parecer + timeline
â”‚
â”œâ”€â”€ comprovacao.html        # PÃ¡gina standalone - Envio de comprovaÃ§Ã£o
â”‚   â””â”€â”€ 1.181 linhas        # Drag & drop upload + rascunho + prazo alert
â”‚
â”œâ”€â”€ styles.css              # Estilos globais compartilhados
â”‚   â””â”€â”€ 1.200 linhas        # Tema, componentes, responsividade
â”‚
â”œâ”€â”€ app.js                  # LÃ³gica da aplicaÃ§Ã£o (apenas para index.html)
â”‚   â””â”€â”€ 2.700+ linhas       # Estado global, CRUD, renderizaÃ§Ãµes, navegaÃ§Ã£o
â”‚
â”œâ”€â”€ README.md               # DocumentaÃ§Ã£o bÃ¡sica do projeto
â”œâ”€â”€ CLAUDE.md               # Guia detalhado para desenvolvimento
â”œâ”€â”€ AGENTS.md               # Guia rÃ¡pido para agentes IA
â””â”€â”€ COMO_RESETAR_DADOS.md   # InstruÃ§Ãµes para limpar localStorage
```

**Total:** ~10.600 linhas de cÃ³digo (HTML + CSS + JavaScript)

---

### 5.2 ConvenÃ§Ãµes de Nomenclatura

#### 5.2.1 Arquivos

**HTML:**
```
index.html              â†’ Ponto de entrada principal
[domÃ­nio].html          â†’ PÃ¡ginas standalone (plural para listagens)
[aÃ§Ã£o].html             â†’ PÃ¡ginas standalone (singular para aÃ§Ãµes)

Exemplos:
âœ… proposicoes.html     (listagem/gestÃ£o)
âœ… publicacao.html      (aÃ§Ã£o de publicar)
âœ… avaliacao.html       (aÃ§Ã£o de avaliar)
âœ… comprovacao.html     (aÃ§Ã£o de comprovar)
```

**CSS:**
```
styles.css              â†’ Ãšnico arquivo de estilos global
                          (sem CSS modules, sem arquivos separados)
```

**JavaScript:**
```
app.js                  â†’ Ãšnico arquivo de lÃ³gica (para index.html)
                          (pÃ¡ginas standalone tÃªm <script> inline)
```

---

#### 5.2.2 Identificadores (IDs e Classes)

**IDs (JavaScript targets):**
```javascript
// PadrÃ£o: camelCase
#dashboardPage
#correicoesTable
#cadastroForm
#submitButton
#detailModal

// Uso: document.getElementById('dashboardPage')
```

**Classes (CSS styling):**
```css
/* PadrÃ£o: kebab-case */
.stat-card
.btn-primary
.modal-overlay
.timeline-item
.empty-state

/* BEM quando aplicÃ¡vel */
.modal__header
.modal__body
.modal__footer
.card--highlighted
```

---

#### 5.2.3 VariÃ¡veis JavaScript

**Globais (escopo de pÃ¡gina):**
```javascript
// Arrays de dados: plural, camelCase
let correicoes = [];
let proposicoes = [];

// Objetos Ãºnicos: singular, camelCase
let currentUser = null;
let dashboardConfig = {};

// Estado da UI: descritivo, camelCase
let dashboardCorreicaoFilter = null;
let correicoesSortColumn = null;
let correicoesSortDirection = 'asc';
```

**Locais (escopo de funÃ§Ã£o):**
```javascript
// Dados: substantivos
const proposicao = proposicoes.find(p => p.id === id);
const filteredData = data.filter(item => item.active);

// Elementos DOM: sufixo descritivo
const tableBody = document.querySelector('tbody');
const submitBtn = document.getElementById('submitButton');
const formEl = document.getElementById('cadastroForm');

// Booleanos: prefixo is/has/should
const isValid = validateForm(data);
const hasPermission = currentUser.type === 'admin';
const shouldRender = filteredData.length > 0;

// Contadores/Ã­ndices: i, j, k ou descritivos
for (let i = 0; i < items.length; i++) { }
for (const [index, item] of items.entries()) { }
```

**Constantes:**
```javascript
// SCREAMING_SNAKE_CASE para constantes verdadeiras
const MAX_FILE_SIZE = 10 * 1024 * 1024;
const ALLOWED_FILE_TYPES = ['pdf', 'doc', 'docx', 'jpg', 'png'];
const DEFAULT_PAGE_SIZE = 20;

// camelCase para configuraÃ§Ãµes que nÃ£o mudam mas nÃ£o sÃ£o "constantes matemÃ¡ticas"
const availableTags = [
    { id: 'administrativo', label: 'Administrativo' },
    { id: 'tecnologia', label: 'Tecnologia' }
];
```

---

#### 5.2.4 FunÃ§Ãµes

**Prefixos Indicando Tipo de Retorno:**

```javascript
// get â†’ Retorna valor (pode ser null/undefined)
function getProposicaoById(id) { return proposicoes.find(p => p.id === id); }
function getUserPermissions() { return currentUser?.permissions || []; }

// find â†’ Retorna array (nunca null, pode ser vazio)
function findProposicoesByStatus(status) { return proposicoes.filter(...); }
function findCorreicoesAtivas() { return correicoes.filter(c => c.status === 'ativo'); }

// is/has/should â†’ Retorna boolean
function isAdmin() { return currentUser?.type === 'admin'; }
function hasComprovacao(proposicaoId) { return proposicoes.find(p => p.id === proposicaoId).rascunhos.length > 0; }
function shouldShowWarning(prazo) { return new Date(prazo) < new Date(); }

// calculate/compute â†’ Retorna valor calculado
function calculateTotalProposicoes() { return proposicoes.length; }
function computeStatusDistribution() { return { pendente: 5, em_analise: 3 }; }

// format â†’ Retorna string formatada
function formatDate(dateString) { return new Date(dateString).toLocaleDateString('pt-BR'); }
function formatFileSize(bytes) { return `${(bytes / 1024).toFixed(2)} KB`; }

// render â†’ Void, atualiza DOM
function renderTable() { document.querySelector('tbody').innerHTML = generateTableHTML(); }
function renderDashboard() { updateStatCards(); drawCharts(); }

// update â†’ Void, modifica estado e/ou DOM
function updateProposicaoStatus(id, status) { /* modifica array + DOM */ }
function updateDashboard() { /* recalcula e re-renderiza */ }

// handle â†’ Void, processa evento
function handleSubmit(event) { event.preventDefault(); /* lÃ³gica */ }
function handleFilterChange() { /* aplica filtro e re-renderiza */ }

// show/hide â†’ Void, controla visibilidade
function showPage(pageId) { /* esconde todas, mostra uma */ }
function hideModal() { modal.classList.add('hidden'); }

// toggle â†’ Void, alterna estado
function toggleSidebar() { sidebar.classList.toggle('open'); }
function toggleSelection(id) { /* adiciona ou remove de array */ }

// create/add/remove/delete â†’ Modifica dados, retorna void ou objeto
function createCorreicao(data) { return { id: generateId(), ...data }; }
function addProposicao(proposicao) { proposicoes.push(proposicao); }
function removeFile(index) { uploadedFiles.splice(index, 1); }

// save/load â†’ I/O operations
function saveToLocalStorage() { localStorage.setItem('correicoes', JSON.stringify(correicoes)); }
function loadFromLocalStorage() { correicoes = JSON.parse(localStorage.getItem('correicoes')) || []; }

// validate â†’ Retorna boolean ou objeto de erros
function validateForm(data) { return data.numero && data.descricao; }
function validateProposicao(prop) { return { valid: true, errors: [] }; }
```

---

### 5.3 ModularizaÃ§Ã£o (Pattern)

Embora o sistema nÃ£o use mÃ³dulos ES6 formais (por ser zero-dependency), ele organiza o cÃ³digo em **blocos funcionais** dentro de `app.js`.

**Estrutura de app.js (~2.700 linhas):**

```javascript
// ============================================
// 1. ESTADO GLOBAL (linhas 1-50)
// ============================================
let correicoes = [];
let proposicoes = [];
let currentUser = null;
let dashboardCorreicaoFilter = null;
// ...

// ============================================
// 2. DADOS INICIAIS (linhas 51-400)
// ============================================
function initializeSampleData() {
    correicoes = [
        { id: 1, numero: 'COR-2024-01', /* ... */ },
        // ...
    ];
    proposicoes = [
        { id: 1, numero: 'PROP-2024-0001', /* ... */ },
        // ...
    ];
}

// ============================================
// 3. UTILITÃRIOS GERAIS (linhas 401-600)
// ============================================
function formatDate(dateString) { /* ... */ }
function formatDateTime(dateString) { /* ... */ }
function getStatusLabel(status) { /* ... */ }
function generateUniqueId() { /* ... */ }

// ============================================
// 4. PERSISTÃŠNCIA (linhas 601-700)
// ============================================
function saveToLocalStorage() { /* ... */ }
function loadFromLocalStorage() { /* ... */ }
function loadUserSession() { /* ... */ }
function saveUserSession(user) { /* ... */ }

// ============================================
// 5. AUTENTICAÃ‡ÃƒO (linhas 701-850)
// ============================================
function handleLogin(event) { /* ... */ }
function logout() { /* ... */ }
function showLoginPage() { /* ... */ }
function showMainApp() { /* ... */ }

// ============================================
// 6. NAVEGAÃ‡ÃƒO (linhas 851-950)
// ============================================
function showPage(pageId) { /* ... */ }
function setupHashNavigation() { /* ... */ }

// ============================================
// 7. DASHBOARD (linhas 951-1400)
// ============================================
function updateDashboard() { /* ... */ }
function drawChart(data) { /* ... */ }
function drawValoracaoChart(data) { /* ... */ }
function populateDashboardCorreicaoFilter() { /* ... */ }

// ============================================
// 8. CORREIÃ‡Ã•ES (linhas 1401-1900)
// ============================================
function renderCorreicoesTable() { /* ... */ }
function viewCorreicaoDetails(id) { /* ... */ }
function sortCorreicoesBy(column) { /* ... */ }
function filtrarCorreicoesPorStatus() { /* ... */ }

// ============================================
// 9. PROPOSIÃ‡Ã•ES (linhas 1901-2100)
// ============================================
function renderProposicoesTable() { /* ... */ }
function viewDetails(id) { /* ... */ }
function renderHistoricoTimeline(historico) { /* ... */ }

// ============================================
// 10. CADASTROS (linhas 2101-2400)
// ============================================
function handleCadastroCorreicao(event) { /* ... */ }
function handleCadastroProposicao(event) { /* ... */ }
function populateCorreicaoSelect() { /* ... */ }

// ============================================
// 11. COMPROVAÃ‡Ã•ES (linhas 2401-2550)
// ============================================
function populateProposicaoSelect() { /* ... */ }
function abrirComprovacaoModal(id) { /* ... */ }
function salvarRascunho() { /* ... */ }

// ============================================
// 12. AVALIAÃ‡Ã•ES (linhas 2551-2700)
// ============================================
function renderAvaliacaoTable() { /* ... */ }
function abrirAvaliacaoModal(id) { /* ... */ }
function submitAvaliacao(id) { /* ... */ }

// ============================================
// 13. INICIALIZAÃ‡ÃƒO (linhas 2701-fim)
// ============================================
window.addEventListener('DOMContentLoaded', () => {
    loadFromLocalStorage();
    if (correicoes.length === 0) {
        initializeSampleData();
    }
    loadUserSession();
    setupHashNavigation();
});
```

**BenefÃ­cios da OrganizaÃ§Ã£o:**
- **Navegabilidade:** FÃ¡cil encontrar cÃ³digo por seÃ§Ã£o
- **Manutenibilidade:** MudanÃ§as isoladas em blocos especÃ­ficos
- **Legibilidade:** ComentÃ¡rios de seÃ§Ã£o delimitam blocos

---

## 6. PadrÃµes de CÃ³digo JavaScript

### 6.1 Estilo de CÃ³digo

**IndentaÃ§Ã£o:** 4 espaÃ§os (nÃ£o tabs)

```javascript
function exemplo() {
    if (condicao) {
        // 4 espaÃ§os
        fazAlgo();
    }
}
```

**Aspas:** Single quotes `'` para strings (exceto HTML com atributos)

```javascript
const texto = 'OlÃ¡ mundo';
const html = `<div class="card">${texto}</div>`; // Template literals com backticks
```

**Ponto e vÃ­rgula:** Sempre explÃ­cito ao final de statements

```javascript
const x = 10;
const y = 20;
fazAlgo();
```

**EspaÃ§amento:**

```javascript
// âœ… BOM: EspaÃ§os ao redor de operadores
const total = a + b;
if (x === 5) { }

// âŒ MAU: Sem espaÃ§os
const total=a+b;
if(x===5){}

// âœ… BOM: EspaÃ§o apÃ³s palavras-chave
if (condicao) { }
for (let i = 0; i < 10; i++) { }

// âœ… BOM: Sem espaÃ§o em chamadas de funÃ§Ã£o
fazAlgo(parametro);

// âŒ MAU: Com espaÃ§o
fazAlgo (parametro);
```

**DeclaraÃ§Ã£o de VariÃ¡veis:**

```javascript
// âœ… BOM: Uma declaraÃ§Ã£o por linha
const x = 10;
const y = 20;
const z = 30;

// âŒ MAU: MÃºltiplas em uma linha
const x = 10, y = 20, z = 30;
```

**Arrays e Objetos:**

```javascript
// âœ… BOM: Arrays curtos em uma linha
const cores = ['vermelho', 'verde', 'azul'];

// âœ… BOM: Arrays longos com quebras
const proposicao = {
    id: 1,
    numero: 'PROP-2024-0001',
    descricao: 'DescriÃ§Ã£o longa...',
    status: ['pendente', 'nova'],
    tags: ['administrativo', 'tecnologia']
};

// âœ… BOM: Trailing comma em objetos/arrays multi-linha
const obj = {
    a: 1,
    b: 2,
    c: 3, // â† trailing comma facilita diffs
};
```

---

### 6.2 FunÃ§Ãµes e Escopo

#### 6.2.1 DeclaraÃ§Ã£o de FunÃ§Ãµes

**Function Declarations vs Arrow Functions:**

```javascript
// âœ… Function Declaration: Para funÃ§Ãµes nomeadas no escopo global
function renderTable() {
    // this Ã© dinÃ¢mico (Ãºtil para event handlers de elementos)
}

// âœ… Arrow Function: Para callbacks e funÃ§Ãµes anÃ´nimas
const filteredData = data.filter(item => item.active);
const doubled = numbers.map(n => n * 2);

// âœ… Arrow Function: Para mÃ©todos que nÃ£o precisam de 'this'
const utils = {
    formatDate: (date) => new Date(date).toLocaleDateString('pt-BR')
};

// âŒ EVITAR: Arrow function no escopo global (perde hoisting)
const renderTable = () => { /* ... */ };
// Problema: nÃ£o pode ser chamada antes de ser definida
```

**ParÃ¢metros:**

```javascript
// âœ… Default parameters
function formatDate(dateString, format = 'DD/MM/YYYY') {
    // ...
}

// âœ… Destructuring de objetos
function createProposicao({ numero, descricao, correicaoId }) {
    return {
        id: generateId(),
        numero,
        descricao,
        correicaoId,
        status: ['pendente', 'nova']
    };
}

// Uso
const prop = createProposicao({
    numero: 'PROP-2024-0001',
    descricao: 'Texto',
    correicaoId: 1
});

// âœ… Rest parameters
function calcularMedia(...numeros) {
    return numeros.reduce((a, b) => a + b, 0) / numeros.length;
}
```

**Retorno:**

```javascript
// âœ… Early return para validaÃ§Ãµes
function getProposicaoById(id) {
    if (!id) return null;
    if (id < 1) return null;

    return proposicoes.find(p => p.id === id);
}

// âœ… Return explÃ­cito mesmo em arrow functions de uma linha (legibilidade)
const doubleNumbers = numbers.map(n => {
    return n * 2;
});

// âš ï¸ AceitÃ¡vel: Implicit return em casos muito simples
const doubleNumbers = numbers.map(n => n * 2);
```

---

#### 6.2.2 Escopo e Closures

**let vs const:**

```javascript
// âœ… Preferir const sempre que possÃ­vel
const MAX_SIZE = 10;
const proposicoes = []; // Array constante (conteÃºdo pode mudar)

// âœ… let apenas quando a variÃ¡vel serÃ¡ reatribuÃ­da
let currentPage = 'dashboard';
let contador = 0;
for (let i = 0; i < 10; i++) {
    contador += i;
}

// âŒ EVITAR: var (escopo de funÃ§Ã£o, hoisting confuso)
var x = 10; // NÃ£o usar
```

**Closures:**

```javascript
// âœ… Closure para encapsular estado
function createCounter(initialValue = 0) {
    let count = initialValue; // Privado via closure

    return {
        increment: () => ++count,
        decrement: () => --count,
        getValue: () => count
    };
}

const counter = createCounter(10);
counter.increment(); // 11
counter.getValue(); // 11
// count nÃ£o Ã© acessÃ­vel diretamente

// âœ… Closure em event listeners
function setupFileUpload() {
    const uploadedFiles = []; // Compartilhado entre listeners

    document.getElementById('fileInput').addEventListener('change', (e) => {
        uploadedFiles.push(...e.target.files);
        renderFilesList(uploadedFiles);
    });

    document.getElementById('clearBtn').addEventListener('click', () => {
        uploadedFiles.length = 0; // Limpa array
        renderFilesList(uploadedFiles);
    });
}
```

---

### 6.3 GestÃ£o de Estado

#### 6.3.1 Estado Global (Single Source of Truth)

**PrincÃ­pio:** Todos os dados residem em arrays/objetos globais. A UI Ã© sempre derivada destes dados.

```javascript
// ============================================
// ESTADO GLOBAL (fonte Ãºnica de verdade)
// ============================================
let correicoes = [];
let proposicoes = [];
let currentUser = null;

// Estado da UI (derivado, nÃ£o persistido)
let dashboardCorreicaoFilter = null;
let correicoesSortColumn = null;
let correicoesSortDirection = 'asc';
```

**Regra de Ouro:** Nunca manipule DOM diretamente sem atualizar o estado primeiro.

```javascript
// âŒ MAU: ManipulaÃ§Ã£o direta do DOM sem atualizar estado
function marcarComoVisto(id) {
    document.querySelector(`[data-id="${id}"]`).classList.add('visto');
}

// âœ… BOM: Atualizar estado, depois re-renderizar
function marcarComoVisto(id) {
    const prop = proposicoes.find(p => p.id === id);
    prop.visto = true;
    saveToLocalStorage();
    renderProposicoesTable(); // Re-renderiza a partir do estado
}
```

---

#### 6.3.2 MutaÃ§Ãµes de Estado

**PadrÃ£o de MutaÃ§Ã£o:**

```javascript
// 1. Mutar o estado (array/objeto global)
// 2. Persistir (localStorage)
// 3. Re-renderizar UI afetada

function addProposicao(proposicao) {
    // 1. MutaÃ§Ã£o
    proposicoes.push(proposicao);

    // 2. PersistÃªncia
    saveToLocalStorage();

    // 3. Re-renderizaÃ§Ã£o
    renderProposicoesTable();
    updateDashboard();
}
```

**MutaÃ§Ãµes Complexas (Status Bidimensional):**

```javascript
function updateProposicaoStatus(id, newStatusProcessual, newValoracao) {
    // Buscar proposiÃ§Ã£o
    const prop = proposicoes.find(p => p.id === id);
    if (!prop) return;

    // Guardar status anterior
    const statusAnterior = [...prop.status];

    // Atualizar status
    prop.status = [newStatusProcessual, newValoracao];

    // Adicionar entrada no histÃ³rico (append-only)
    prop.historico.push({
        tipo: 'avaliacao',
        data: new Date().toISOString(),
        usuario: currentUser.ramoMPNome || 'Corregedoria Nacional',
        statusAnterior,
        statusNovo: prop.status
    });

    // Persistir e re-renderizar
    saveToLocalStorage();
    renderProposicoesTable();
    updateDashboard();
}
```

**Importante:** HistÃ³rico Ã© **append-only** - nunca modificar ou remover entradas existentes.

---

#### 6.3.3 SincronizaÃ§Ã£o com localStorage

**PadrÃ£o de PersistÃªncia:**

```javascript
// ============================================
// SAVE (apÃ³s cada mutaÃ§Ã£o)
// ============================================
function saveToLocalStorage() {
    try {
        localStorage.setItem('correicoes', JSON.stringify(correicoes));
        localStorage.setItem('proposicoes', JSON.stringify(proposicoes));
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
    } catch (e) {
        console.error('Erro ao salvar em localStorage:', e);
        // PossÃ­vel: Quota exceeded
        alert('âš ï¸ Erro ao salvar dados. EspaÃ§o de armazenamento pode estar cheio.');
    }
}

// ============================================
// LOAD (na inicializaÃ§Ã£o)
// ============================================
function loadFromLocalStorage() {
    try {
        const correicoesData = localStorage.getItem('correicoes');
        const proposicoesData = localStorage.getItem('proposicoes');

        correicoes = correicoesData ? JSON.parse(correicoesData) : [];
        proposicoes = proposicoesData ? JSON.parse(proposicoesData) : [];

        // ValidaÃ§Ã£o de integridade (opcional)
        if (!Array.isArray(correicoes)) correicoes = [];
        if (!Array.isArray(proposicoes)) proposicoes = [];

    } catch (e) {
        console.error('Erro ao carregar de localStorage:', e);
        // Dados corrompidos
        correicoes = [];
        proposicoes = [];
    }
}

// ============================================
// RESET (limpar tudo)
// ============================================
function resetData() {
    if (!confirm('âš ï¸ Isso apagarÃ¡ TODOS os dados. Confirma?')) return;

    localStorage.clear();
    correicoes = [];
    proposicoes = [];
    currentUser = null;

    alert('âœ… Dados resetados com sucesso!');
    location.reload();
}
```

---

### 6.4 Event Handling

#### 6.4.1 Inline vs addEventListener

**Inline Handlers (onclick, onsubmit):**
- âœ… **Usar para:** NavegaÃ§Ã£o simples, aÃ§Ãµes diretas
- âŒ **Evitar para:** LÃ³gica complexa, mÃºltiplos listeners

```html
<!-- âœ… BOM: NavegaÃ§Ã£o simples -->
<button onclick="showPage('dashboard')">Dashboard</button>
<button onclick="logout()">Sair</button>

<!-- âœ… BOM: AÃ§Ãµes diretas -->
<button onclick="closeModal()">Fechar</button>
<button onclick="limparFiltros()">Limpar Filtros</button>

<!-- âŒ EVITAR: LÃ³gica complexa inline -->
<button onclick="const data = getData(); if(validate(data)) { save(data); }">
    Salvar
</button>
```

**addEventListener:**
- âœ… **Usar para:** FormulÃ¡rios, lÃ³gica complexa, mÃºltiplos listeners

```javascript
// âœ… BOM: FormulÃ¡rios
document.getElementById('cadastroForm').addEventListener('submit', (event) => {
    event.preventDefault();

    const formData = extractFormData(event.target);
    if (!validateForm(formData)) return;

    saveProposicao(formData);
    event.target.reset();
});

// âœ… BOM: MÃºltiplos listeners no mesmo elemento
const input = document.getElementById('searchInput');
input.addEventListener('input', handleSearch);
input.addEventListener('focus', () => input.select());
input.addEventListener('blur', saveSearchHistory);

// âœ… BOM: Event delegation (performance)
document.querySelector('tbody').addEventListener('click', (event) => {
    const button = event.target.closest('button[data-action]');
    if (!button) return;

    const action = button.dataset.action;
    const id = parseInt(button.dataset.id);

    switch (action) {
        case 'view': viewDetails(id); break;
        case 'edit': editProposicao(id); break;
        case 'delete': deleteProposicao(id); break;
    }
});
```

---

#### 6.4.2 PrevenÃ§Ã£o de Comportamentos PadrÃ£o

```javascript
// âœ… Sempre prevenir submit padrÃ£o de formulÃ¡rios
form.addEventListener('submit', (event) => {
    event.preventDefault(); // Impede reload da pÃ¡gina
    // LÃ³gica aqui
});

// âœ… Prevenir propagaÃ§Ã£o quando necessÃ¡rio
button.addEventListener('click', (event) => {
    event.stopPropagation(); // Impede bubbling
    // LÃ³gica aqui
});

// âœ… Prevenir comportamento padrÃ£o de links quando usados como botÃµes
link.addEventListener('click', (event) => {
    event.preventDefault();
    doSomething();
});
```

---

## 7. PadrÃµes de CSS

### 7.1 Metodologia BEM (Parcial)

O sistema usa **BEM light** - aplica conceitos do BEM mas sem seguir rigidamente a sintaxe.

**BEM Conceitos:**
- **Block:** Componente independente (ex: `.modal`, `.stat-card`)
- **Element:** Parte de um block (ex: `.modal__header`, `.modal__body`)
- **Modifier:** VariaÃ§Ã£o de block/element (ex: `.modal--large`, `.btn--primary`)

**AplicaÃ§Ã£o no Sistema:**

```css
/* Block */
.modal { }
.stat-card { }
.timeline { }

/* Element (com __) */
.modal__header { }
.modal__body { }
.modal__footer { }

.stat-card__icon { }
.stat-card__value { }
.stat-card__label { }

/* Modifier (com --) */
.modal--large { }
.modal--fullscreen { }

.btn--primary { }
.btn--secondary { }
.btn--danger { }
```

**TambÃ©m Aceito (VariaÃ§Ãµes):**

```css
/* Classes utilitÃ¡rias simples */
.hidden { display: none; }
.text-center { text-align: center; }
.mt-2 { margin-top: 2rem; }

/* Classes semÃ¢nticas (nÃ£o BEM) */
.badge { }
.badge-pendente { }
.badge-finalizada { }
```

---

### 7.2 Custom Properties (CSS Variables)

**Tema Centralizado:**

```css
:root {
    /* Cores Principais */
    --primary-color: #003366;
    --primary-dark: #002244;
    --secondary-color: #0066cc;

    /* Cores de Status */
    --success-color: #28a745;
    --warning-color: #ffc107;
    --danger-color: #dc3545;
    --info-color: #17a2b8;

    /* Cores Neutras */
    --text-color: #333333;
    --text-muted: #6c757d;
    --border-color: #dee2e6;
    --bg-light: #f8f9fa;

    /* EspaÃ§amento */
    --spacing-xs: 0.25rem;
    --spacing-sm: 0.5rem;
    --spacing-md: 1rem;
    --spacing-lg: 1.5rem;
    --spacing-xl: 2rem;

    /* Border Radius */
    --radius-sm: 4px;
    --radius-md: 8px;
    --radius-lg: 12px;
    --radius-full: 9999px;

    /* Sombras */
    --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
    --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
    --shadow-lg: 0 10px 25px rgba(0,0,0,0.15);

    /* Tipografia */
    --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    --font-size-sm: 0.875rem;
    --font-size-base: 1rem;
    --font-size-lg: 1.125rem;
    --font-size-xl: 1.5rem;
}

/* Uso */
.btn-primary {
    background: var(--primary-color);
    color: white;
    padding: var(--spacing-md) var(--spacing-lg);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-sm);
}
```

**Sobrescrita em Contextos:**

```css
/* Dark mode (exemplo futuro) */
@media (prefers-color-scheme: dark) {
    :root {
        --text-color: #f0f0f0;
        --bg-light: #1a1a1a;
        --border-color: #444;
    }
}

/* Tema por pÃ¡gina (se necessÃ¡rio) */
.publicacao-page {
    --primary-color: #006633; /* Verde para publicaÃ§Ã£o */
}
```

---

### 7.3 Responsividade

**Mobile First:**

```css
/* Base: Mobile (< 768px) */
.container {
    padding: 1rem;
}

.sidebar {
    position: fixed;
    left: -100%;
    width: 80%;
}

/* Tablet (â‰¥ 768px) */
@media (min-width: 768px) {
    .container {
        padding: 2rem;
    }

    .sidebar {
        left: 0;
        width: 250px;
    }
}

/* Desktop (â‰¥ 1200px) */
@media (min-width: 1200px) {
    .container {
        max-width: 1140px;
        margin: 0 auto;
    }
}
```

**Queries EspecÃ­ficas:**

```css
/* Hover apenas em dispositivos que suportam */
@media (hover: hover) {
    .btn:hover {
        background: var(--primary-dark);
        transform: translateY(-1px);
    }
}

/* ImpressÃ£o */
@media print {
    .no-print {
        display: none !important;
    }

    .main-content {
        margin-left: 0;
    }

    * {
        color: black !important;
        background: white !important;
    }
}
```

---

**Fim da Parte 5.2**

---

## PARTE 5.3 - SEGURANÃ‡A, PERFORMANCE E DEPLOY

### 8. SeguranÃ§a

#### 8.1 Contexto de SeguranÃ§a

**Status Atual: ProtÃ³tipo Educacional**

O sistema Ã© um **protÃ³tipo funcional client-side** sem backend, autenticaÃ§Ã£o real ou controle de acesso server-side. Este documento descreve:
- Vulnerabilidades conhecidas do protÃ³tipo atual
- Medidas de mitigaÃ§Ã£o implementadas (limitadas)
- RecomendaÃ§Ãµes crÃ­ticas para produÃ§Ã£o futura

**âš ï¸ AVISO CRÃTICO:**

Este sistema **NÃƒO DEVE SER USADO EM PRODUÃ‡ÃƒO** sem implementar:
- Backend com autenticaÃ§Ã£o real (JWT, OAuth2, ou sessÃµes server-side)
- ValidaÃ§Ã£o server-side de todas as operaÃ§Ãµes
- Controle de acesso baseado em roles (RBAC)
- HTTPS obrigatÃ³rio
- Auditoria e logging server-side
- ProteÃ§Ã£o CSRF com tokens

---

#### 8.2 ValidaÃ§Ã£o Client-Side vs Server-Side

**Implementado: ValidaÃ§Ã£o Client-Side**

**PropÃ³sito:** Melhorar UX, feedback imediato, reduzir requisiÃ§Ãµes invÃ¡lidas.

**HTML5 Required Attributes:**

```html
<!-- Cadastro de ProposiÃ§Ã£o -->
<form id="cadastroForm">
    <label for="numero">NÃºmero da ProposiÃ§Ã£o *</label>
    <input type="text" id="numero" name="numero" required
           placeholder="PROP-2024-XXXX">

    <label for="descricao">DescriÃ§Ã£o *</label>
    <textarea id="descricao" name="descricao" required
              maxlength="5000"></textarea>

    <label for="correicaoId">CorreiÃ§Ã£o Vinculada *</label>
    <select id="correicaoId" name="correicaoId" required>
        <option value="">Selecione...</option>
    </select>

    <label for="prazoComprovacao">Prazo de ComprovaÃ§Ã£o *</label>
    <input type="date" id="prazoComprovacao" name="prazoComprovacao" required>

    <button type="submit">Cadastrar</button>
</form>
```

**JavaScript Validation:**

```javascript
// ValidaÃ§Ã£o adicional antes de submit
document.getElementById('cadastroForm').addEventListener('submit', (e) => {
    e.preventDefault();

    // 1. ValidaÃ§Ã£o de campos obrigatÃ³rios
    const numero = document.getElementById('numero').value.trim();
    const descricao = document.getElementById('descricao').value.trim();
    const correicaoId = document.getElementById('correicaoId').value;

    if (!numero || !descricao || !correicaoId) {
        alert('âš ï¸ Preencha todos os campos obrigatÃ³rios.');
        return;
    }

    // 2. ValidaÃ§Ã£o de formato
    if (!/^PROP-\d{4}-\d{4}$/.test(numero)) {
        alert('âš ï¸ NÃºmero da proposiÃ§Ã£o invÃ¡lido. Use formato: PROP-2024-0001');
        return;
    }

    // 3. ValidaÃ§Ã£o de unicidade
    if (proposicoes.some(p => p.numero === numero)) {
        alert('âš ï¸ NÃºmero da proposiÃ§Ã£o jÃ¡ cadastrado.');
        return;
    }

    // 4. ValidaÃ§Ã£o de tamanho
    if (descricao.length > 5000) {
        alert('âš ï¸ DescriÃ§Ã£o excede o limite de 5.000 caracteres.');
        return;
    }

    // Prosseguir com cadastro...
});
```

**LimitaÃ§Ãµes:**

âŒ **Client-side validation pode ser contornada** via DevTools ou requests diretos
âŒ **Sem validaÃ§Ã£o server-side** - dados nÃ£o sÃ£o revalidados no backend
âŒ **Sem sanitizaÃ§Ã£o server-side** - possÃ­vel injeÃ§Ã£o de dados maliciosos

**RecomendaÃ§Ã£o para ProduÃ§Ã£o:**

```javascript
// Backend Node.js/Express - ValidaÃ§Ã£o Server-Side
const { body, validationResult } = require('express-validator');

app.post('/api/proposicoes', [
    // ValidaÃ§Ã£o obrigatÃ³ria
    body('numero').notEmpty().matches(/^PROP-\d{4}-\d{4}$/),
    body('descricao').notEmpty().isLength({ max: 5000 }),
    body('correicaoId').isInt({ min: 1 }),

    // SanitizaÃ§Ã£o
    body('numero').trim().escape(),
    body('descricao').trim().escape(),
], async (req, res) => {
    const errors = validationResult(req);
    if (!errors.isEmpty()) {
        return res.status(400).json({ errors: errors.array() });
    }

    // ValidaÃ§Ã£o de unicidade (banco de dados)
    const existing = await Proposicao.findOne({ numero: req.body.numero });
    if (existing) {
        return res.status(409).json({ error: 'NÃºmero jÃ¡ cadastrado' });
    }

    // Prosseguir com insert...
});
```

---

#### 8.3 ProteÃ§Ã£o Contra XSS (Cross-Site Scripting)

**Vulnerabilidade Atual:**

O sistema utiliza `.innerHTML` sem sanitizaÃ§Ã£o em mÃºltiplos locais:

```javascript
// VULNERÃVEL: Aceita HTML arbitrÃ¡rio
tbody.innerHTML = proposicoes.map(p => `
    <tr>
        <td>${p.numero}</td>
        <td>${p.descricao}</td>  <!-- Se descricao contÃ©m <script>, serÃ¡ executado -->
    </tr>
`).join('');
```

**ExploraÃ§Ã£o HipotÃ©tica:**

```javascript
// Atacante cadastra proposiÃ§Ã£o com payload XSS
const payload = '<img src=x onerror="alert(document.cookie)">';
proposicoes.push({
    numero: 'PROP-2024-0001',
    descricao: payload,  // Quando renderizado, executa JavaScript
});
```

**MitigaÃ§Ã£o Implementada (Parcial):**

1. **Sem input de HTML rico** - Sistema nÃ£o possui WYSIWYG editor
2. **Dados controlados** - Todos os dados vÃªm de formulÃ¡rios HTML5
3. **Sem execuÃ§Ã£o de scripts user-supplied** - NÃ£o usa `eval()` ou `Function()`

**MitigaÃ§Ã£o Adicional (Recomendada para ProduÃ§Ã£o):**

**OpÃ§Ã£o 1: SanitizaÃ§Ã£o com DOMPurify**

```html
<!-- Adicionar DOMPurify via CDN -->
<script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
```

```javascript
// Sanitizar HTML antes de inserir
tbody.innerHTML = DOMPurify.sanitize(
    proposicoes.map(p => `
        <tr>
            <td>${p.numero}</td>
            <td>${p.descricao}</td>
        </tr>
    `).join('')
);
```

**OpÃ§Ã£o 2: Usar `.textContent` ao invÃ©s de `.innerHTML`**

```javascript
// Criar elementos via DOM API (sem innerHTML)
const row = document.createElement('tr');

const numeroCell = document.createElement('td');
numeroCell.textContent = p.numero;  // textContent escapa HTML automaticamente

const descricaoCell = document.createElement('td');
descricaoCell.textContent = p.descricao;  // Seguro contra XSS

row.appendChild(numeroCell);
row.appendChild(descricaoCell);
tbody.appendChild(row);
```

**OpÃ§Ã£o 3: Content Security Policy (CSP)**

```html
<!-- Adicionar no <head> de todas as pÃ¡ginas -->
<meta http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline';">
```

**RecomendaÃ§Ã£o:**
- **ProtÃ³tipo:** Adicionar sanitizaÃ§Ã£o com DOMPurify (mÃ­nimo)
- **ProduÃ§Ã£o:** SanitizaÃ§Ã£o server-side + CSP + `.textContent` onde possÃ­vel

---

#### 8.4 ProteÃ§Ã£o Contra CSRF (Cross-Site Request Forgery)

**Vulnerabilidade Atual:**

Como o sistema Ã© **100% client-side**, CSRF nÃ£o Ã© aplicÃ¡vel (nÃ£o hÃ¡ endpoints server-side para atacar).

**CenÃ¡rio Futuro com Backend:**

Sem proteÃ§Ã£o CSRF, atacante pode criar pÃ¡gina maliciosa:

```html
<!-- Site malicioso: atacante.com -->
<form action="https://cnmp.gov.br/api/proposicoes" method="POST">
    <input type="hidden" name="numero" value="PROP-MALICIOSO">
    <input type="hidden" name="descricao" value="ProposiÃ§Ã£o falsa">
</form>

<script>
    // Auto-submit quando vÃ­tima abre a pÃ¡gina
    document.forms[0].submit();
</script>
```

**MitigaÃ§Ã£o para ProduÃ§Ã£o (ObrigatÃ³ria):**

**1. CSRF Tokens (Synchronizer Token Pattern)**

```javascript
// Backend Node.js/Express - Middleware CSRF
const csrf = require('csurf');
const csrfProtection = csrf({ cookie: true });

app.use(csrfProtection);

// Endpoint retorna token CSRF
app.get('/api/csrf-token', (req, res) => {
    res.json({ csrfToken: req.csrfToken() });
});

// Validar token em requisiÃ§Ãµes mutativas
app.post('/api/proposicoes', csrfProtection, (req, res) => {
    // Se token invÃ¡lido, retorna 403 automaticamente
    // ...
});
```

```javascript
// Frontend - Incluir token CSRF em requests
let csrfToken = null;

// Obter token no login
async function login() {
    const response = await fetch('/api/csrf-token');
    const data = await response.json();
    csrfToken = data.csrfToken;
}

// Incluir token em todas as mutaÃ§Ãµes
async function createProposicao(proposicao) {
    const response = await fetch('/api/proposicoes', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'CSRF-Token': csrfToken,  // Token no header
        },
        body: JSON.stringify(proposicao),
    });
}
```

**2. SameSite Cookies**

```javascript
// Backend - Configurar cookies com SameSite
res.cookie('sessionId', sessionId, {
    httpOnly: true,
    secure: true,  // Apenas HTTPS
    sameSite: 'strict',  // Previne envio cross-site
    maxAge: 3600000,  // 1 hora
});
```

**3. VerificaÃ§Ã£o de Origin/Referer**

```javascript
// Backend - Middleware de verificaÃ§Ã£o
app.use((req, res, next) => {
    const origin = req.get('Origin');
    const referer = req.get('Referer');

    const allowedOrigins = ['https://cnmp.gov.br', 'https://www.cnmp.gov.br'];

    if (req.method !== 'GET' && !allowedOrigins.includes(origin)) {
        return res.status(403).json({ error: 'Origem nÃ£o permitida' });
    }

    next();
});
```

---

#### 8.5 AutenticaÃ§Ã£o e Controle de Acesso

**ImplementaÃ§Ã£o Atual (Insegura):**

```javascript
// âŒ INSEGURO: Aceita qualquer usuÃ¡rio/senha
function handleLogin(event) {
    event.preventDefault();

    const username = document.getElementById('loginUsername').value;
    const password = document.getElementById('loginPassword').value;  // Ignorado!
    const userType = document.getElementById('loginType').value;

    // âŒ Sem validaÃ§Ã£o de credenciais
    currentUser = {
        username,
        type: userType,  // 'admin' ou 'user'
        ramoMP: userType === 'user' ? document.getElementById('loginRamoMP').value : null
    };

    // âŒ Salva em localStorage (facilmente editÃ¡vel)
    localStorage.setItem('currentUser', JSON.stringify(currentUser));

    showDashboard();
}
```

**Vulnerabilidades:**
- âŒ Sem verificaÃ§Ã£o de senha
- âŒ UsuÃ¡rio pode editar localStorage e se tornar admin
- âŒ Sem sessÃµes server-side
- âŒ Sem expiraÃ§Ã£o de login

**ImplementaÃ§Ã£o para ProduÃ§Ã£o (JWT):**

**Backend:**

```javascript
const jwt = require('jsonwebtoken');
const bcrypt = require('bcrypt');

// Login endpoint
app.post('/api/login', async (req, res) => {
    const { username, password } = req.body;

    // 1. Buscar usuÃ¡rio no banco
    const user = await User.findOne({ username });
    if (!user) {
        return res.status(401).json({ error: 'Credenciais invÃ¡lidas' });
    }

    // 2. Verificar senha (hashed com bcrypt)
    const validPassword = await bcrypt.compare(password, user.passwordHash);
    if (!validPassword) {
        return res.status(401).json({ error: 'Credenciais invÃ¡lidas' });
    }

    // 3. Gerar JWT token
    const token = jwt.sign(
        {
            userId: user.id,
            username: user.username,
            type: user.type,  // 'admin' ou 'user'
            ramoMP: user.ramoMP
        },
        process.env.JWT_SECRET,
        { expiresIn: '8h' }  // Token expira em 8 horas
    );

    res.json({ token, user: { username: user.username, type: user.type } });
});

// Middleware de autenticaÃ§Ã£o
function authenticateToken(req, res, next) {
    const token = req.headers['authorization']?.split(' ')[1];  // Bearer <token>

    if (!token) {
        return res.status(401).json({ error: 'Token nÃ£o fornecido' });
    }

    jwt.verify(token, process.env.JWT_SECRET, (err, user) => {
        if (err) {
            return res.status(403).json({ error: 'Token invÃ¡lido ou expirado' });
        }

        req.user = user;
        next();
    });
}

// Middleware de autorizaÃ§Ã£o (admin only)
function requireAdmin(req, res, next) {
    if (req.user.type !== 'admin') {
        return res.status(403).json({ error: 'Acesso negado' });
    }
    next();
}

// Endpoint protegido
app.post('/api/proposicoes', authenticateToken, requireAdmin, async (req, res) => {
    // Apenas admins autenticados podem criar proposiÃ§Ãµes
    // ...
});
```

**Frontend:**

```javascript
let authToken = null;

async function handleLogin(event) {
    event.preventDefault();

    const username = document.getElementById('loginUsername').value;
    const password = document.getElementById('loginPassword').value;

    try {
        const response = await fetch('/api/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
        });

        if (!response.ok) {
            throw new Error('Credenciais invÃ¡lidas');
        }

        const data = await response.json();
        authToken = data.token;

        // Salvar token em localStorage (ou sessionStorage para maior seguranÃ§a)
        localStorage.setItem('authToken', authToken);

        // Decodificar payload do JWT (sem verificar assinatura - confia no backend)
        const payload = JSON.parse(atob(authToken.split('.')[1]));
        currentUser = payload;

        showDashboard();
    } catch (error) {
        alert('âŒ Erro no login: ' + error.message);
    }
}

// Incluir token em todas as requisiÃ§Ãµes
async function createProposicao(proposicao) {
    const response = await fetch('/api/proposicoes', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${authToken}`  // Token JWT
        },
        body: JSON.stringify(proposicao)
    });

    if (response.status === 401 || response.status === 403) {
        // Token invÃ¡lido ou expirado - redirecionar para login
        logout();
        alert('âš ï¸ SessÃ£o expirada. FaÃ§a login novamente.');
        return;
    }

    // ...
}
```

---

#### 8.6 SanitizaÃ§Ã£o de Dados

**localStorage Data Integrity:**

Atualmente, dados no localStorage podem ser editados manualmente via DevTools:

```javascript
// âŒ Atacante pode editar localStorage diretamente
localStorage.setItem('proposicoes', JSON.stringify([
    { id: 1, status: ['finalizada', 'finalizada'] }  // ForÃ§ar status
]));
```

**MitigaÃ§Ã£o (Client-Side):**

Implementar validaÃ§Ã£o de integridade com checksums:

```javascript
const crypto = require('crypto');  // No backend

// Gerar hash SHA-256 dos dados
function generateHash(data) {
    return crypto.createHash('sha256').update(JSON.stringify(data)).digest('hex');
}

// Salvar com hash
function saveToLocalStorage() {
    const data = { correicoes, proposicoes };
    const hash = generateHash(data);

    localStorage.setItem('appData', JSON.stringify(data));
    localStorage.setItem('appDataHash', hash);
}

// Carregar e verificar integridade
function loadFromLocalStorage() {
    const dataStr = localStorage.getItem('appData');
    const savedHash = localStorage.getItem('appDataHash');

    if (!dataStr || !savedHash) return null;

    const data = JSON.parse(dataStr);
    const computedHash = generateHash(data);

    if (computedHash !== savedHash) {
        console.error('âš ï¸ Dados corrompidos ou adulterados!');
        localStorage.clear();
        return null;
    }

    return data;
}
```

**RecomendaÃ§Ã£o para ProduÃ§Ã£o:**
- **NÃ£o confiar em dados client-side** - sempre revalidar no backend
- **Armazenar dados sensÃ­veis apenas no servidor** (banco de dados)

---

### 9. Performance

#### 9.1 OtimizaÃ§Ã£o de Carregamento

**MÃ©trica Atual:**

- **Tamanho Total:** ~10KB (HTML + CSS + JS minificados e gzipped)
- **Requests:** 3 arquivos (index.html, styles.css, app.js)
- **Tempo de Carregamento:** < 200ms (localhost)
- **First Contentful Paint (FCP):** < 300ms
- **Time to Interactive (TTI):** < 500ms

**TÃ©cnicas Implementadas:**

**1. Zero Dependencies (JÃ¡ implementado)**

Sem bibliotecas externas = sem download de megabytes de cÃ³digo:

```
React app tÃ­pica: 300-500KB (minificado)
Sistema NAD:      ~10KB (minificado)
```

**2. Inline Critical CSS (Recomendado para ProduÃ§Ã£o)**

```html
<!-- Adicionar no <head> para renderizaÃ§Ã£o instantÃ¢nea -->
<style>
    /* Critical CSS - Above the fold */
    :root { --primary-color: #003366; }
    body { margin: 0; font-family: Arial, sans-serif; }
    .sidebar { width: 250px; background: var(--primary-color); }
    .main-content { margin-left: 250px; padding: 2rem; }
</style>

<!-- Carregar CSS completo assincronamente -->
<link rel="preload" href="styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="styles.css"></noscript>
```

**3. Lazy Loading de Imagens (Se aplicÃ¡vel)**

```html
<!-- Carregar apenas quando visÃ­vel -->
<img src="placeholder.jpg" data-src="imagem-real.jpg" loading="lazy" alt="...">
```

```javascript
// Intersection Observer API
const images = document.querySelectorAll('img[data-src]');

const imageObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            const img = entry.target;
            img.src = img.dataset.src;
            img.removeAttribute('data-src');
            imageObserver.unobserve(img);
        }
    });
});

images.forEach(img => imageObserver.observe(img));
```

**4. Preconnect/Prefetch (Se usar CDN futuro)**

```html
<!-- Conectar a domÃ­nios externos antes de precisar -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="dns-prefetch" href="https://cdn.example.com">

<!-- Prefetch de recursos que serÃ£o usados em breve -->
<link rel="prefetch" href="proposicoes.html">
<link rel="prefetch" href="publicacao.html">
```

---

#### 9.2 OtimizaÃ§Ã£o de RenderizaÃ§Ã£o

**Problemas de Performance Potenciais:**

**1. RenderizaÃ§Ã£o de Tabelas Grandes**

```javascript
// âŒ Renderiza TODAS as linhas de uma vez (potencialmente lento com 10.000+ proposiÃ§Ãµes)
function renderProposicoesTable() {
    const tbody = document.querySelector('#proposicoesTable tbody');

    tbody.innerHTML = proposicoes.map(p => `
        <tr>
            <td>${p.numero}</td>
            <td>${p.descricao}</td>
            <!-- ... 10 colunas ... -->
        </tr>
    `).join('');  // Se proposicoes.length = 10.000, cria 10.000 elementos DOM
}
```

**SoluÃ§Ã£o 1: PaginaÃ§Ã£o**

```javascript
const ITEMS_PER_PAGE = 50;
let currentPage = 1;

function renderProposicoesTable() {
    const start = (currentPage - 1) * ITEMS_PER_PAGE;
    const end = start + ITEMS_PER_PAGE;
    const pageItems = filteredProposicoes.slice(start, end);

    tbody.innerHTML = pageItems.map(p => `...`).join('');

    // Renderizar controles de paginaÃ§Ã£o
    renderPaginationControls();
}

function renderPaginationControls() {
    const totalPages = Math.ceil(filteredProposicoes.length / ITEMS_PER_PAGE);

    document.getElementById('pagination').innerHTML = `
        <button onclick="goToPage(1)" ${currentPage === 1 ? 'disabled' : ''}>Â«</button>
        <button onclick="goToPage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>â€¹</button>
        <span>PÃ¡gina ${currentPage} de ${totalPages}</span>
        <button onclick="goToPage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>â€º</button>
        <button onclick="goToPage(${totalPages})" ${currentPage === totalPages ? 'disabled' : ''}>Â»</button>
    `;
}

function goToPage(page) {
    currentPage = page;
    renderProposicoesTable();
}
```

**SoluÃ§Ã£o 2: Virtual Scrolling (AvanÃ§ado)**

```javascript
// Renderizar apenas linhas visÃ­veis na viewport
const ROW_HEIGHT = 50;  // Altura fixa de cada linha (px)
const VISIBLE_ROWS = Math.ceil(window.innerHeight / ROW_HEIGHT) + 5;  // +5 buffer

let scrollTop = 0;

function renderVirtualTable() {
    const startIndex = Math.floor(scrollTop / ROW_HEIGHT);
    const endIndex = startIndex + VISIBLE_ROWS;
    const visibleItems = proposicoes.slice(startIndex, endIndex);

    tbody.innerHTML = visibleItems.map((p, i) => `
        <tr style="transform: translateY(${(startIndex + i) * ROW_HEIGHT}px);">
            <td>${p.numero}</td>
            <!-- ... -->
        </tr>
    `).join('');

    // Container com altura total virtual
    tbody.style.height = `${proposicoes.length * ROW_HEIGHT}px`;
}

// Atualizar ao fazer scroll
tableContainer.addEventListener('scroll', (e) => {
    scrollTop = e.target.scrollTop;
    requestAnimationFrame(renderVirtualTable);
});
```

**2. Debounce em Filtros de Busca**

```javascript
// âŒ Re-renderiza a cada keystroke (potencialmente lento)
searchInput.addEventListener('input', (e) => {
    filterProposicoes(e.target.value);
    renderProposicoesTable();  // Renderiza imediatamente
});

// âœ… Aguarda 300ms sem digitar antes de renderizar
function debounce(func, delay) {
    let timeoutId;
    return function(...args) {
        clearTimeout(timeoutId);
        timeoutId = setTimeout(() => func.apply(this, args), delay);
    };
}

const debouncedSearch = debounce((searchTerm) => {
    filterProposicoes(searchTerm);
    renderProposicoesTable();
}, 300);  // 300ms delay

searchInput.addEventListener('input', (e) => {
    debouncedSearch(e.target.value);
});
```

**3. RequestAnimationFrame para AnimaÃ§Ãµes**

```javascript
// âŒ AnimaÃ§Ã£o via setTimeout (nÃ£o sincronizado com repaint do navegador)
function animateModal() {
    let opacity = 0;
    const interval = setInterval(() => {
        opacity += 0.05;
        modal.style.opacity = opacity;
        if (opacity >= 1) clearInterval(interval);
    }, 16);  // ~60fps
}

// âœ… AnimaÃ§Ã£o via requestAnimationFrame (otimizado pelo navegador)
function animateModal() {
    let opacity = 0;

    function animate() {
        opacity += 0.05;
        modal.style.opacity = opacity;

        if (opacity < 1) {
            requestAnimationFrame(animate);
        }
    }

    requestAnimationFrame(animate);
}
```

---

#### 9.3 OtimizaÃ§Ã£o de Canvas (GrÃ¡ficos)

**Problema: Re-desenho Completo a Cada Update**

```javascript
// âŒ Re-desenha canvas inteiro ao atualizar dados
function updateDashboard() {
    calculateStatistics();
    drawChart();  // Limpa e re-desenha todo o canvas
    drawValoracaoChart();
}
```

**OtimizaÃ§Ã£o 1: MemoizaÃ§Ã£o de Dados**

```javascript
let cachedChartData = null;
let cachedValoracaoData = null;

function updateDashboard() {
    const newChartData = getChartData();
    const newValoracaoData = getValoracaoData();

    // SÃ³ re-desenhar se dados mudaram
    if (JSON.stringify(newChartData) !== JSON.stringify(cachedChartData)) {
        drawChart(newChartData);
        cachedChartData = newChartData;
    }

    if (JSON.stringify(newValoracaoData) !== JSON.stringify(cachedValoracaoData)) {
        drawValoracaoChart(newValoracaoData);
        cachedValoracaoData = newValoracaoData;
    }
}
```

**OtimizaÃ§Ã£o 2: OffscreenCanvas (PreparaÃ§Ã£o Off-Thread)**

```javascript
// Criar canvas off-screen para preparar desenho
const offscreenCanvas = document.createElement('canvas');
offscreenCanvas.width = 800;
offscreenCanvas.height = 400;
const offscreenCtx = offscreenCanvas.getContext('2d');

function drawChart() {
    // 1. Desenhar no canvas off-screen (nÃ£o bloqueia UI)
    offscreenCtx.clearRect(0, 0, offscreenCanvas.width, offscreenCanvas.height);
    // ... desenhar barras, labels, etc. ...

    // 2. Transferir imagem para canvas visÃ­vel (operaÃ§Ã£o rÃ¡pida)
    const visibleCanvas = document.getElementById('chartCanvas');
    const visibleCtx = visibleCanvas.getContext('2d');
    visibleCtx.drawImage(offscreenCanvas, 0, 0);
}
```

**OtimizaÃ§Ã£o 3: Limitar FPS de AnimaÃ§Ãµes**

```javascript
let lastFrameTime = 0;
const FPS = 30;  // Limitar a 30fps (mais que suficiente para charts)
const frameDelay = 1000 / FPS;

function animateChart(timestamp) {
    if (timestamp - lastFrameTime < frameDelay) {
        requestAnimationFrame(animateChart);
        return;
    }

    lastFrameTime = timestamp;

    // Atualizar frame do grÃ¡fico
    updateChartFrame();

    requestAnimationFrame(animateChart);
}
```

---

#### 9.4 GestÃ£o de MemÃ³ria

**Problema: Memory Leaks**

**1. Event Listeners NÃ£o Removidos**

```javascript
// âŒ Event listener nunca Ã© removido (memory leak)
function showModal(id) {
    const modal = document.getElementById('modal');
    modal.classList.remove('hidden');

    // Cada vez que modal abre, adiciona NOVO listener
    document.getElementById('closeBtn').addEventListener('click', () => {
        modal.classList.add('hidden');
    });
}

// âœ… Remover listener ou usar listener Ãºnico global
let closeModalHandler = null;

function showModal(id) {
    const modal = document.getElementById('modal');
    modal.classList.remove('hidden');

    // Remover listener anterior se existir
    if (closeModalHandler) {
        document.getElementById('closeBtn').removeEventListener('click', closeModalHandler);
    }

    // Criar novo listener
    closeModalHandler = () => modal.classList.add('hidden');
    document.getElementById('closeBtn').addEventListener('click', closeModalHandler);
}
```

**2. ReferÃªncias a Elementos Removidos do DOM**

```javascript
// âŒ MantÃ©m referÃªncia a elemento que jÃ¡ foi removido
let cachedTableRows = document.querySelectorAll('tbody tr');

function deleteRow(id) {
    const row = cachedTableRows.find(r => r.dataset.id == id);
    row.remove();  // Elemento removido do DOM
    // cachedTableRows ainda contÃ©m referÃªncia ao elemento removido (memory leak)
}

// âœ… NÃ£o armazenar referÃªncias a elementos que podem ser removidos
function deleteRow(id) {
    const row = document.querySelector(`tbody tr[data-id="${id}"]`);
    if (row) row.remove();
    // Sem referÃªncias armazenadas - garbage collector pode limpar
}
```

**3. localStorage Size Limit**

```javascript
// âŒ localStorage pode estourar limite de ~5-10MB
function saveToLocalStorage() {
    // Se proposicoes[] crescer indefinidamente, localStorage pode falhar
    localStorage.setItem('proposicoes', JSON.stringify(proposicoes));
}

// âœ… Monitorar tamanho e implementar limpeza/arquivamento
function saveToLocalStorage() {
    const data = JSON.stringify({ correicoes, proposicoes });
    const sizeInBytes = new Blob([data]).size;
    const sizeInMB = (sizeInBytes / 1024 / 1024).toFixed(2);

    console.log(`ğŸ“Š localStorage size: ${sizeInMB} MB`);

    if (sizeInBytes > 5 * 1024 * 1024) {  // > 5MB
        console.warn('âš ï¸ localStorage prÃ³ximo do limite!');
        // OpÃ§Ã£o 1: Remover dados antigos
        // OpÃ§Ã£o 2: Migrar para IndexedDB
        // OpÃ§Ã£o 3: Alertar usuÃ¡rio para exportar dados
    }

    try {
        localStorage.setItem('appData', data);
    } catch (e) {
        if (e.name === 'QuotaExceededError') {
            alert('âš ï¸ Limite de armazenamento excedido! Exporte seus dados e limpe o sistema.');
        }
    }
}
```

---

### 10. Compatibilidade e Deploy

#### 10.1 Compatibilidade de Navegadores

**Requisitos MÃ­nimos:**

| Browser         | VersÃ£o MÃ­nima | LanÃ§amento  | Suporte ES6+ | Suporte CSS Grid |
|----------------|---------------|-------------|--------------|------------------|
| Chrome         | 90+           | Abril 2021  | âœ…           | âœ…               |
| Firefox        | 88+           | Abril 2021  | âœ…           | âœ…               |
| Safari         | 14+           | Set 2020    | âœ…           | âœ…               |
| Edge (Chromium)| 90+           | Abril 2021  | âœ…           | âœ…               |
| Opera          | 76+           | Abril 2021  | âœ…           | âœ…               |

**NÃ£o Suportado:**
- âŒ Internet Explorer 11 (fim de suporte: 15/06/2022)
- âŒ Edge Legacy (versÃµes nÃ£o-Chromium)
- âŒ Safari < 14

**VerificaÃ§Ã£o de Compatibilidade:**

```javascript
// Detectar features obrigatÃ³rias no carregamento
window.addEventListener('DOMContentLoaded', () => {
    const requiredFeatures = [
        'localStorage' in window,
        'fetch' in window,
        'Promise' in window,
        'Map' in window,
        'Set' in window,
        CSS.supports('display', 'grid'),
        CSS.supports('display', 'flex'),
    ];

    const isCompatible = requiredFeatures.every(feature => feature);

    if (!isCompatible) {
        document.body.innerHTML = `
            <div style="padding: 2rem; text-align: center;">
                <h1>âš ï¸ Navegador NÃ£o Suportado</h1>
                <p>Este sistema requer um navegador moderno:</p>
                <ul style="list-style: none;">
                    <li>Chrome 90+</li>
                    <li>Firefox 88+</li>
                    <li>Safari 14+</li>
                    <li>Edge 90+</li>
                </ul>
                <p>Por favor, atualize seu navegador e tente novamente.</p>
            </div>
        `;
    }
});
```

---

#### 10.2 Processo de Deploy

**OpÃ§Ã£o 1: Deploy EstÃ¡tico Simples (Recomendado para ProtÃ³tipo)**

**ServiÃ§os gratuitos compatÃ­veis:**
- **GitHub Pages** (gratuito, HTTPS automÃ¡tico)
- **Netlify** (gratuito, CI/CD, HTTPS automÃ¡tico)
- **Vercel** (gratuito, edge functions, HTTPS automÃ¡tico)
- **Surge** (gratuito, CLI simples)
- **Cloudflare Pages** (gratuito, CDN global)

**Deploy com GitHub Pages:**

```bash
# 1. Criar repositÃ³rio no GitHub
git init
git add .
git commit -m "Initial commit - Sistema NAD"
git branch -M main
git remote add origin https://github.com/usuario/sistema-nad.git
git push -u origin main

# 2. Habilitar GitHub Pages
# - Ir em Settings > Pages
# - Source: Deploy from branch
# - Branch: main, folder: / (root)
# - Save

# 3. Acessar site em:
# https://usuario.github.io/sistema-nad/
```

**Deploy com Netlify (Drag & Drop):**

1. Acessar https://app.netlify.com/drop
2. Arrastar pasta `sistema_do_nad/` para Ã¡rea de upload
3. Site publicado em segundos em `https://random-name.netlify.app`
4. (Opcional) Configurar domÃ­nio customizado

**Deploy com Surge (CLI):**

```bash
# 1. Instalar Surge globalmente
npm install -g surge

# 2. Deploy (primeira vez pede email/senha)
cd sistema_do_nad
surge

# Site publicado em: https://random-subdomain.surge.sh
```

---

**OpÃ§Ã£o 2: Deploy em Servidor PrÃ³prio**

**Nginx Configuration:**

```nginx
# /etc/nginx/sites-available/sistema-nad

server {
    listen 80;
    server_name cnmp-nad.example.com;

    # Redirecionar HTTP para HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name cnmp-nad.example.com;

    # Certificado SSL (Let's Encrypt recomendado)
    ssl_certificate /etc/letsencrypt/live/cnmp-nad.example.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/cnmp-nad.example.com/privkey.pem;

    # Root directory
    root /var/www/sistema-nad;
    index index.html;

    # Servir arquivos estÃ¡ticos
    location / {
        try_files $uri $uri/ =404;
    }

    # Cache headers para assets
    location ~* \.(css|js|jpg|png|svg|woff|woff2)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # Gzip compression
    gzip on;
    gzip_types text/css application/javascript text/html;
    gzip_min_length 1000;

    # Security headers
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
}
```

**Deploy Script:**

```bash
#!/bin/bash
# deploy.sh

# 1. Build (minificaÃ§Ã£o opcional)
echo "ğŸ“¦ Preparando arquivos..."

# 2. Upload para servidor via rsync
echo "ğŸš€ Fazendo upload..."
rsync -avz --delete \
    --exclude 'node_modules' \
    --exclude '.git' \
    --exclude 'deploy.sh' \
    ./ user@servidor.com:/var/www/sistema-nad/

# 3. Recarregar Nginx
echo "ğŸ”„ Recarregando Nginx..."
ssh user@servidor.com 'sudo systemctl reload nginx'

echo "âœ… Deploy concluÃ­do!"
echo "ğŸŒ Site disponÃ­vel em: https://cnmp-nad.example.com"
```

---

#### 10.3 Troubleshooting Comum

**Problema 1: localStorage NÃ£o Persiste Entre SessÃµes**

**Causa:** Navegador em modo privado/anÃ´nimo ou configuraÃ§Ãµes de privacidade bloqueando localStorage.

**SoluÃ§Ã£o:**

```javascript
// Detectar se localStorage estÃ¡ disponÃ­vel e funcionando
function testLocalStorage() {
    try {
        const testKey = '__localStorage_test__';
        localStorage.setItem(testKey, 'test');
        localStorage.removeItem(testKey);
        return true;
    } catch (e) {
        return false;
    }
}

if (!testLocalStorage()) {
    alert(`
        âš ï¸ localStorage nÃ£o disponÃ­vel!

        PossÃ­veis causas:
        - NavegaÃ§Ã£o anÃ´nima/privada ativada
        - ConfiguraÃ§Ãµes de privacidade bloqueando cookies/storage
        - Cota de armazenamento excedida

        Seus dados nÃ£o serÃ£o salvos entre sessÃµes.
    `);
}
```

---

**Problema 2: CSS NÃ£o Carrega Corretamente**

**Causa:** Caminho relativo incorreto em subpastas.

**SoluÃ§Ã£o:** Usar caminhos absolutos ou relativos Ã  raiz:

```html
<!-- âŒ Caminho relativo (quebra em subpastas) -->
<link rel="stylesheet" href="styles.css">

<!-- âœ… Caminho absoluto (funciona em qualquer profundidade) -->
<link rel="stylesheet" href="/styles.css">

<!-- âœ… Caminho relativo Ã  raiz (recomendado para deploy) -->
<link rel="stylesheet" href="./styles.css">
```

---

**Problema 3: Caracteres Especiais Quebrados (Encoding)**

**Causa:** Charset nÃ£o declarado ou arquivo salvo em encoding errado.

**SoluÃ§Ã£o:**

```html
<!-- Sempre declarar charset UTF-8 no <head> -->
<meta charset="UTF-8">
```

```bash
# Verificar encoding do arquivo
file -I index.html
# Deve retornar: text/html; charset=utf-8

# Converter arquivo para UTF-8 se necessÃ¡rio
iconv -f ISO-8859-1 -t UTF-8 index.html > index_utf8.html
```

---

**Problema 4: Modal NÃ£o Fecha ao Clicar Fora**

**Causa:** Event listener nÃ£o configurado corretamente.

**SoluÃ§Ã£o:**

```javascript
// Fechar modal ao clicar no backdrop (Ã¡rea escura fora do modal)
document.querySelectorAll('.modal').forEach(modal => {
    modal.addEventListener('click', (e) => {
        // Fechar apenas se clique foi no backdrop (nÃ£o no conteÃºdo)
        if (e.target === modal) {
            modal.classList.add('hidden');
        }
    });
});
```

---

**Problema 5: Performance Ruim em Tabelas Grandes**

**Causa:** RenderizaÃ§Ã£o de milhares de linhas de uma vez.

**SoluÃ§Ã£o:** Implementar paginaÃ§Ã£o (ver SeÃ§Ã£o 9.2).

---

#### 10.4 Roadmap para ProduÃ§Ã£o

**Curto Prazo (ProtÃ³tipo â†’ MVP):**
1. âœ… Implementar sanitizaÃ§Ã£o XSS (DOMPurify)
2. âœ… Adicionar paginaÃ§Ã£o em tabelas
3. âœ… Implementar debounce em filtros
4. âœ… Adicionar validaÃ§Ã£o de tamanho do localStorage
5. âœ… Criar pÃ¡gina de aviso de compatibilidade

**MÃ©dio Prazo (MVP â†’ Beta):**
1. ğŸ”„ Migrar para backend Node.js/Express
2. ğŸ”„ Implementar autenticaÃ§Ã£o JWT
3. ğŸ”„ Adicionar banco de dados (PostgreSQL)
4. ğŸ”„ Implementar upload real de arquivos
5. ğŸ”„ Adicionar testes automatizados (Jest + Cypress)

**Longo Prazo (Beta â†’ ProduÃ§Ã£o):**
1. ğŸ”„ IntegraÃ§Ã£o com sistemas CNMP existentes
2. ğŸ”„ NotificaÃ§Ãµes por email automÃ¡ticas
3. ğŸ”„ RelatÃ³rios avanÃ§ados e dashboards
4. ğŸ”„ Auditoria completa de todas as aÃ§Ãµes
5. ğŸ”„ App mobile (React Native ou PWA)

---

## ConclusÃ£o do Documento

Este documento descreveu a arquitetura tÃ©cnica completa do **Sistema de Acompanhamento de ProposiÃ§Ãµes - CNMP**, cobrindo:

### Parte 5.1 - VisÃ£o Geral da Arquitetura
- âœ… 6 PrincÃ­pios Arquiteturais (Zero Dependencies, Progressive Enhancement, etc.)
- âœ… Stack TecnolÃ³gico (HTML5, CSS3, JavaScript ES6+)
- âœ… Arquitetura de Alto NÃ­vel (Componentes, Fluxo de Dados, Ciclo de Vida)

### Parte 5.2 - Estrutura de CÃ³digo e PadrÃµes
- âœ… OrganizaÃ§Ã£o de Arquivos (~10.600 LOC total)
- âœ… ConvenÃ§Ãµes de Nomenclatura (camelCase, kebab-case, prefixos)
- âœ… ModularizaÃ§Ã£o (13 blocos funcionais em app.js)
- âœ… PadrÃµes de JavaScript (Estado, Eventos, Escopo)
- âœ… PadrÃµes de CSS (BEM light, Custom Properties, Responsividade)

### Parte 5.3 - SeguranÃ§a, Performance e Deploy
- âœ… SeguranÃ§a (ValidaÃ§Ã£o, XSS, CSRF, AutenticaÃ§Ã£o futura)
- âœ… Performance (RenderizaÃ§Ã£o, Canvas, MemÃ³ria)
- âœ… Compatibilidade (Browsers modernos, feature detection)
- âœ… Deploy (GitHub Pages, Netlify, Nginx)
- âœ… Troubleshooting (Problemas comuns e soluÃ§Ãµes)
- âœ… Roadmap (ProtÃ³tipo â†’ MVP â†’ ProduÃ§Ã£o)

**PÃºblico-Alvo:**
- Desenvolvedores implementando melhorias no sistema
- Auditores tÃ©cnicos avaliando arquitetura
- Estudantes aprendendo desenvolvimento web moderno sem frameworks

**Status:** âœ… **DOCUMENTO COMPLETO**

---

**Fim da Parte 5.3 - Documento Completo**

---
